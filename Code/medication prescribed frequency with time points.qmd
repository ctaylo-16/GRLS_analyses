---
title: "Medication usage associated with time points and lifetime"
format: html
editor: visual
---

# Medication prescribing associations with time points and frequency

Load in medications dataset and endpoints datasets:

```{r}
library(tidyverse)
medications <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_medications_initial_tidy.csv")
endpoints<- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/study_endpoints.csv")
```

## Frequency of prescription of a drug group in whole life:

-   using active ingredients group as this is broad and can try medication ingredient itself if this shows any interesting results

Group for each dog rows by active ingredient group

```{r}
number_of_prescriptions_drug_groups_whole_life <- medications %>%
  group_by(subject_id, active_ingredient_groups) %>%  # Group by both dog and drug category
  summarise(lifetime_total_prescriptions = n(), .groups = "drop") 


# Pivot the table to wide format
number_of_prescriptions_drug_groups_whole_life_wide <- number_of_prescriptions_drug_groups_whole_life %>%
  pivot_wider(
    names_from = active_ingredient_groups,  # Make drug groups into column names
    values_from = lifetime_total_prescriptions,      # Fill columns with the counts
    values_fill = 0                         # Replace NA with 0 for drug groups not prescribed
  )
```

Group for each dog rows by medication ingredient top 100 group

```{r}
number_of_prescriptions_ingredient_100_groups_whole_life <- medications %>%
  group_by(subject_id, medication_ingredients_100) %>%  # Group by both dog and drug category
  summarise(lifetime_total_prescriptions = n(), .groups = "drop") 


# Pivot the table to wide format
number_of_prescriptions_ingredient_100_groups_whole_life_wide <- number_of_prescriptions_ingredient_100_groups_whole_life %>%
  pivot_wider(
    names_from = medication_ingredients_100,  # Make drug groups into column names
    values_from = lifetime_total_prescriptions,      # Fill columns with the counts
    values_fill = 0                         # Replace NA with 0 for drug groups not prescribed
  )
```

## Medications length of time/number of times prescribed:

Non use vs intermediate use vs long term use.

There is a few papers defining this usage:

"We classiﬁed use as non-use (0–1 prescription), in- termediate use (2–7 prescriptions), and long-term use (≥8 prescrip- tions). Eight prescriptions was chosen as a cut-off as drugs for chronic treatment are typically supplied for 3 months use for each dispensing in Denmark, whereby our deﬁnition oflong-termusewould correspond to two years' cumulative treatment." - Pottegard et al., 2016

\- exclude drug usage for the year prior to diagnosis (recognised that increased prescribing in year prior to diagnosis possibly due to cancer diagnosing issues PLUS likely wont be involved in cancer diagnosis
