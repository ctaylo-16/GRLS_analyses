avg_frequency_5y_prior_endpoint >20 & avg_frequency_5y_prior_endpoint<= 40 ~ "monthly",
avg_frequency_5y_prior_endpoint >40 & avg_frequency_5y_prior_endpoint<= 60 ~ "weekly",
avg_frequency_5y_prior_endpoint >60 & avg_frequency_5y_prior_endpoint <= 80 ~ "daily",
avg_frequency_5y_prior_endpoint >80 &avg_frequency_5y_prior_endpoint<= 100 ~ "multi_daily"
))
#swap not_recorded for NA and exclude from univar this way
cohort_no_not_rec <- cohort_abr %>%
mutate(across(
where(~ is.character(.) | is.factor(.)),
~ factor(na_if(as.character(.), "not_recorded"))
))
dependent <- "had_HSA"
# All other variables as explanatory variables
explanatory = c(
#demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever"
)
# Create a univariable logistic regression table
univar_table <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,column = TRUE)
#column = TRUE does case and contorl counts for each variable category rather than rowise
univar_table2 <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,na_include = TRUE,column=TRUE)
# View the results
print(univar_table)
write.csv(univar_table,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.csv")
#save as worddoc
# Install and load the required packages
library(officer)
library(flextable)
# Create a Word document
doc <- read_docx()
# Convert finalfit output to a flextable
results_flextable <- flextable(univar_table)
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
# Save the Word document
print(doc, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.docx")
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_auto.R")
cohort_abr$had_HSA <- as.factor(cohort_abr$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_abr2 <- cohort_abr %>%
dplyr::select(  #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever","had_HSA")
cohort_abr2<- cohort_abr2%>%
mutate_all(~factor(ifelse(is.na(.), "not_recorded", as.character(.))))
cohort_abr2 <- cohort_abr2%>%
mutate(heats_before_neutering_terciles = factor(heats_before_neutering_terciles, levels = c("0", "1-<=2", ">2-<=4", ">4-12","Intact Female","Male","not_recorded")))
#neuter reason levels
cohort_abr2<- cohort_abr2%>%
mutate(neutered_reason = factor(neutered_reason, levels = c("Elective",  "Medical Reason", "Entire","Unknown","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(mode_purina_BCS_5y_prior_endpoint = factor(mode_purina_BCS_5y_prior_endpoint, levels = c("5", "3", "4", "6","7","8","9","not_recorded")))
#change BCS to be over underweight
cohort_abr2 <- cohort_abr2 %>%
mutate(mode_BCS_classify = case_when(
mode_purina_BCS_5y_prior_endpoint == "1" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "2" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "3" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "4" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "5" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "6" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "7" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "8" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "9" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "not_recorded" ~"not_recorded",
))
#set age levels
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_bio = factor(age_at_final_date_bio, levels = c(">5-<8y","<5y",  ">8-<11y", ">11-<13y",">13y")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_GB = factor(age_at_final_date_GB, levels = c(">7-<9y","<5y", ">5-<7y",  ">9-<11y",">11-<13y",">13y")))
#manually assign height, weight, BCS factor levles and age at neuter and age at diagnosis
#height
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_quartiles = factor(avg_weight_5y_prior_endpoint_quartiles, levels = c("12.47-<20.83kg", ">=20.83-<23.23kg", ">=23.23-26.98kg", ">=26.98-37.01","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = factor(avg_weight_5y_prior_endpoint_kg_biological, levels = c(">15-<=25kg","<15kg",">25-<=35kg",">35","not_recorded")))
#bcs
cohort_abr2 <- cohort_abr2%>%
mutate(avg_purina_BCS_5y_prior_endpoint_quartiles = factor(avg_purina_BCS_5y_prior_endpoint_quartiles, levels = c("3.3-<5", ">=5-<5.28", ">=5.28-<5.86", ">=5.86 - 9","not_recorded")))
#neut age
cohort_abr2<- cohort_abr2 %>%
mutate(age_at_neuter_years_quartiles = factor(age_at_neuter_years_quartiles, levels = c("0.15-<0.52y", ">=0.52-<0.83y", ">=0.83-2.44y", ">=2.44-9.59y","Entire","not_recorded")))
#diagnosis age
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years","not_recorded")))
#breed tercile levels
cohort_abr2 <- cohort_abr2%>%
mutate(num_breeding_before_neutering_terciles = factor(num_breeding_before_neutering_terciles, levels = c(">0-<3",">=3-<9",">=9-142","not_bred","not_recorded")))
colnames(cohort_abr2)
cols_to_modify <- 146:195 # replace with your actual column indices
for (i in cols_to_modify) {
current_levels <- levels(cohort_abr2[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_abr2[[i]] <- factor(cohort_abr2[[i]], levels = new_levels)
}
}
#need to set the activity splits into ordinal format
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy3_splits = factor(avg_activity_freq_sy3_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy1_2_splits = factor(avg_activity_freq_sy1_2_splits, levels = c("never","less_than_weekly","min_weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_duration_sy1_2_splits = factor(avg_activity_duration_sy1_2_splits, levels = c("less_than_30min","between_30_60_min","between_60_90_min","between_90_120_min","more_than_120_min","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_intensity_sy3_splits = factor(avg_activity_intensity_sy3_splits, levels = c("slow_walks","average_walks","brisk_walks","jogs","runs","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_frequency_5y_prior_endpoint_splits = factor(avg_frequency_5y_prior_endpoint_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
table(cohort_abr2$avg_weight_5y_prior_endpoint_kg_biological)
table(cohort_abr2$avg_weight_5y_prior_endpoint_quartiles)
univar_results <- univar_logistic_regression(cohort_abr2, "had_HSA", explanatory)
# If you want to write the output to CSV after running:
write.csv(univar_results, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar.csv", row.names = FALSE)
#create tidy table from univar output
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_table.R")
#read in data
univar <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar.csv")
#function to tidy data and write to csv in a table ready to use for univar
table <- univar_logistic_regression_table(univar,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_tidied_table.csv")
#remove all the redunt variable name bits of table so just one row per variable
blank_repeated_variable <- function(df, fill = ""){
df$Variable <- ifelse(duplicated(df$Variable), fill, df$Variable)
return(df)
}
table <- blank_repeated_variable(table, fill = " ")
#crop table to keep relevant cols
table_2 <- table %>%
dplyr::select(c(Variable,term,Case_summary,Control_summary,OR_CI,p.value,LR_T_pvalue,))
print(table_2)
print(knitr::kable(table_2, row.names=FALSE,
align=c("l", "l", "r", "r", "r")))
write.csv(table_2,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_tidied_table2.csv")
#save table_2 as a word doc file too
doc <- read_docx()
# Convert finalfit output to a flextable
results_flextable_2 <- flextable(table_2)
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable_2) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
# Save the Word document
print(doc, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_tidied_table2.docx")
#female neut
FN_pop <- cohort_abr2 %>%
filter(sex_neuter == "F Neutered")
#male neut
MN_pop<- cohort_abr2 %>%
filter(sex_neuter == "M Neutered")
#both sexes neut
N_pop<- cohort_abr2 %>%
filter(sex_neuter == "F Neutered"| sex_neuter == "M Neutered")
#male entire
ME_pop<- cohort_abr2 %>%
filter(sex_neuter == "M Entire")
#female pop
F_pop <-cohort_abr2 %>%
filter(sex_neuter == "F Neutered"| sex_neuter=="F Entire")
#univar for each pop
# Now run the function
#explan neut variables
#FN
explan_neut <- c("neutered_females_bred_with_count_ever","spayed_while_in_heat","spayed_while_pregnant","heats_before_neutering","heats_before_neutering_tercile","preg_pre_neuter")
univar_results_FN <- univar_logistic_regression(FN_pop, "had_HSA", explan_neut)
# If you want to write the output to CSV after running:
write.csv(univar_results_FN, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_FN_pop.csv", row.names = FALSE)
#MN
explan_neut2 <- c("neutered_sired_litters_natural_ever")
univar_results_MN <- univar_logistic_regression(MN_pop, "had_HSA", explan_neut2)
# If you want to write the output to CSV after running:
write.csv(univar_results_MN, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_MN_pop.csv", row.names = FALSE)
#Neut pop
explan_neut3 <- c("neutered_ever_bred","neutered_reason","num_breeding_before_neutering_tercile")
univar_results_N <- univar_logistic_regression(N_pop, "had_HSA", explan_neut3)
# If you want to write the output to CSV after running:
write.csv(univar_results_N, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_N_pop.csv", row.names = FALSE)
#ME
explan_neut4 <- c("intact_sired_litters_natural_ever")
univar_results_ME<- univar_logistic_regression(ME_pop, "had_HSA", explan_neut4)
# If you want to write the output to CSV after running:
write.csv(univar_results_ME, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_ME_pop.csv", row.names = FALSE)
#F pop
explan_neut5 <- c("prevent_heat_ever", "no_pregnancy_ever")
univar_results_F<- univar_logistic_regression(F_pop, "had_HSA", explan_neut5)
# If you want to write the output to CSV after running:
write.csv(univar_results_F, "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_F_pop.csv", row.names = FALSE)
#combine all these univar
univar_repro <- rbind(univar_results_F,univar_results_FN,univar_results_ME,univar_results_MN,univar_results_N)
write.csv(univar_repro,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_all_repro_pops.csv", row.names = FALSE)
#format this univar into table for word export
#function to tidy data and write to csv in a table ready to use for univar
table <- univar_logistic_regression_table(univar_repro,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_all_repro_pops_tidied_table.csv")
#remove all the redunt variable name bits of table so just one row per variable
blank_repeated_variable <- function(df, fill = ""){
df$Variable <- ifelse(duplicated(df$Variable), fill, df$Variable)
return(df)
}
table <- blank_repeated_variable(table, fill = " ")
#crop table to keep relevant cols
table_2 <- table %>%
dplyr::select(c(Variable,term,Case_summary,Control_summary,OR_CI,p.value,LR_T_pvalue,))
print(table_2)
print(knitr::kable(table_2, row.names=FALSE,
align=c("l", "l", "r", "r", "r")))
write.csv(table_2,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_all_repro_pops_tidied_table2.csv")
#save table_2 as a word doc file too
doc <- read_docx()
# Convert finalfit output to a flextable
results_flextable_2 <- flextable(table_2)
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable_2) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
# Save the Word document
print(doc, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_all_repro_pops_tidied_table2.docx")
check_levels <- function(df) {
sapply(df, function(x) length(unique(na.omit(x))) >= 2)
}
# Example usage
result <- check_levels(cohort_no_not_rec)
# Print columns that do not meet the condition
names(result[result == FALSE])
cohort_no_not_rec$had_HSA <- as.factor(cohort_no_not_rec$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_no_not_rec<- cohort_no_not_rec %>%
dplyr::select( #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever","had_HSA")
#remove drug not administered as an NA
cols_to_modify <- 145:193  # adjust as needed
for (i in cols_to_modify) {
current_levels <- levels(cohort_no_not_rec[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
# Move it to last level
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_no_not_rec[[i]] <- factor(cohort_no_not_rec[[i]], levels = new_levels)
# Replace it with NA
cohort_no_not_rec[[i]][cohort_no_not_rec[[i]] == "no_medication_records_for_this_time_period"] <- NA
}
}
#remove "endpoint data not recorded for cancer presence" and "no_medication_records_for_this_time_periodistered" to be NAs
strings_to_replace <- c("no_medication_records_for_this_time_period", "did_not_have_endpoint_data")
cohort_no_not_rec <- cohort_no_not_rec %>%
mutate(across(
where(~ is.character(.) || is.factor(.)),
~ {
x <- as.character(.)
x[x %in% strings_to_replace] <- NA
factor(x)
}
))
#univar_logistic_regression(cohort_no_not_rec, "had_HSA", "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_no_missing.csv")
univar_table_no_missing <- cohort_no_not_rec %>%summary_factorlist(dependent, explanatory,
add_dependent_label=TRUE,na_include = FALSE, p=TRUE,column=TRUE)
# View the results
print(univar_table_no_missing)
write.csv(univar_table_no_missing,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_no_missing.csv")
#not using this sect as keeping only variables with sig p for those with other levels sig besides "NA" equivalent
lrt_pvalues <-read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar.csv")
multivar_variables <- lrt_pvalues %>%
filter(LR_T_pvalue <= 0.2) %>%
distinct(predictor)
cols_to_keep = multivar_variables$predictor
cols_to_keep <- append(cols_to_keep, "had_HSA")
cohort_abr_sig <- cohort_abr2[,cols_to_keep]
#missing data removed for p val calculation
pvalues_no_miss <-read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_GRLS_log_reg_univar_no_missing.csv")
multivar_variables2 <- pvalues_no_miss %>%
filter(p <= 0.2) %>%
distinct(Dependent..had_HSA)
cols_to_keep2 = multivar_variables2$Dependent..had_HSA
cols_to_keep2 <- append(cols_to_keep2, "had_HSA")
cols_to_keep2 <- cols_to_keep2[cols_to_keep2 != ""]
#keeping the not recorded variables
cohort_abr_sig2 <- cohort_no_not_rec[,cols_to_keep2]
#keep only these ones for the original cohort with "not_recorded" level as only want to take these ones that are actually univar sig forward to multivar model build
cohort_abr_sig <- cohort_abr2[,cols_to_keep2]
View(cohort_abr_sig2)
colnames(cohort_abr_sig2)
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/corr_matrix_creation.R")
#use sig variables list generated above
create_corr_matrix(cohort_abr_sig,c(1:84), "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg.csv", "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg2.csv","C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg_corrvalue.csv","C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg.png")
corr_values <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg_corrvalue.csv")
#ditch rows where variable 1 and 2 values are same as in another row :
corr_values2 <- corr_values %>%
dplyr::select(-c(X))
corr_values3 <- corr_values2 %>%
mutate(Var1_sorted = pmin(Variable1, Variable2),
Var2_sorted = pmax(Variable1, Variable2)) %>%
distinct(Var1_sorted, Var2_sorted, Correlation, .keep_all = TRUE) %>%
dplyr::select(-c(Var1_sorted, Var2_sorted))  # Remove helper columns
print(corr_values3)
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/corr_matrix_creation.R")
#use sig variables list generated above
create_corr_matrix(cohort_abr_sig2,c(1:84), "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg_no_missing.csv", "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg2_no_missing.csv","C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg_corrvalue_no_missing.csv","C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/hsa_corr_matrix_quartile_logreg_no_missing.png")
dependent <- "had_HSA"
explanatory <- c("age_at_final_date_GB","avg_frequency_5y_prior_endpoint_quartile","quartile_anti_parasites_5y_prior_endpoint","NSAID_ever","gastrointestinal","avg_weight_5y_prior_endpoint_quartiles","sex_neuter","smoke_exposure_study_years_early_life","mast_cell_tumor_present")
final_model_table <-cohort_abr_sig %>%
finalfit(dependent, explanatory, metrics = TRUE,column=TRUE) %>%
kable(format = "html", digits = 2, escape = FALSE) %>%
kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
final_model_table
final_model_table2<- cohort_abr_sig %>%
finalfit(dependent, explanatory, metrics = FALSE,column = TRUE)
final_model_table2_df <- as.data.frame(final_model_table2)
results_flextable <-flextable(final_model_table2_df)
# Create a Word document
doc <- read_docx()
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
print(results_flextable, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/finalfit_logreg_table_all_variables.docx")
model_f<- glm(had_HSA ~ age_at_final_date_GB  + avg_frequency_5y_prior_endpoint_quartile + quartile_anti_parasites_5y_prior_endpoint  +NSAID_ever +  gastrointestinal + avg_weight_5y_prior_endpoint_quartiles + sex_neuter + smoke_exposure_study_years_early_life + mast_cell_tumor_present, data = cohort_abr_sig, family = binomial)
summary(model_f)
logistic.display(model_f)
car::vif(model_f)
model_f<- glm(had_HSA ~ age_at_final_date_GB  + avg_frequency_5y_prior_endpoint_quartile + quartile_anti_parasites_5y_prior_endpoint  +NSAID_ever +  gastrointestinal + avg_weight_5y_prior_endpoint_quartiles + sex_neuter + smoke_exposure_study_years_early_life
, data = cohort_abr_sig, family = binomial)
summary(model_f)
logistic.display(model_f)
car::vif(model_f)
model_f<- glm(had_HSA ~ age_at_final_date_GB  + avg_frequency_5y_prior_endpoint_quartile + quartile_anti_parasites_5y_prior_endpoint  +NSAID_ever +  gastrointestinal + avg_weight_5y_prior_endpoint_quartiles + sex_neuter + smoke_exposure_study_years_early_life
, data = cohort_abr_sig, family = binomial)
summary(model_f)
logistic.display(model_f)
car::vif(model_f)
model_f<- glm(had_HSA ~ age_at_final_date_GB  + avg_frequency_5y_prior_endpoint_splits + quartile_anti_parasites_5y_prior_endpoint  +NSAID_ever +  gastrointestinal + avg_weight_5y_prior_endpoint_quartiles + sex_neuter + smoke_exposure_study_years_early_life
, data = cohort_abr_sig, family = binomial)
summary(model_f)
logistic.display(model_f)
car::vif(model_f)
