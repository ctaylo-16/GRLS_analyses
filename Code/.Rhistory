no_diags<-c("no.record.of.diagnostic.tests")
all_groups_diag <- c(imaging,sampling,laboratory,cardiac_diags,abdo_diags,no_diags)
# Find unique clinical signs that are not in any group
unclassified_diags <- setdiff(summary_table_diag$variable, all_groups_diag)
# Display unclassified clinical signs
print(unclassified_diags)
#strip the diagnostic.tests.recorded. etc. bit from first bit of column names before applying the function to them and then only retaining the ones with >30 cases
colnames(result_df14) <- str_replace_all(colnames(result_df14), "^diagnostic\\.tests\\.recorded_\\d+_\\d+\\.", "")
#ensure all columns have a name
colnames(result_df14)[is.na(colnames(result_df14)) | colnames(result_df14) == ""] <- "unnamed_column"
#now recode DF for whether each patient fits into each of these groups (0=no, 1=yes)
source("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/code/functions/grouping_presence_funct.R")
result_df15 <- result_df14 %>%
mutate(across(84:106, ~ as.numeric(.)))%>%
add_presence_column(imaging, "imaging_done") %>%
add_presence_column(sampling, "sampling_done") %>%
add_presence_column(laboratory, "laboratory_done") %>%
add_presence_column(cardiac_diags, "cardiac_diagnostics_done") %>%
add_presence_column(abdo_diags, "abdo_diagnostics_done") %>%
add_presence_column(no_diags, "no_diagnostics_done")
df_diags <- result_df14 %>%
summarise(across(c(imaging, sampling,laboratory,cardiac_diags,abdo_diags),
~ sum(. == 1)))
# Create a long dataframe, assigning multiple categories dynamically for overlapping treatments
df_long2 <- df_diags %>%
pivot_longer(cols = everything(), names_to = "treatment", values_to = "count") %>%
mutate(category = case_when(
treatment %in% imaging ~ "imaging",
treatment %in% sampling ~ "sampling",
treatment %in% laboratory ~ "lab",
treatment %in% cardiac_diags ~ "cardiac",
treatment %in% abdo_diags ~ "abdo.",
))
# Duplicate rows for treatments appearing in more than one category
df_long2 <- bind_rows(
df_long2,
df_long2 %>%
filter(treatment %in% imaging) %>%
mutate(category = "imaging"),
df_long2 %>%
filter(treatment %in% cardiac_diags) %>%
mutate(category = "cardiac"),
df_long2 %>%
filter(treatment %in% abdo_diags) %>%
mutate(category = "abdo.")
)
#remove incorrect duplications
df_long2<- df_long2 %>%
distinct(treatment, category, .keep_all = TRUE)
# Sort treatments within each category by count
df_long2 <- df_long2 %>%
group_by(category) %>%
arrange(category, count) %>%
ungroup()
# Update the factor levels of the treatment to reflect the sorted order
df_long2$treatment <- factor(df_long2$treatment, levels = unique(df_long2$treatment))
df_long_diag <- df_long2
df_long_diag$treatment <- gsub("\\.", " ", df_long_diag$treatment)
df_long_diag$category <- gsub("\\.", " ", df_long_diag$category)
#tidy up strings in treatment
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "ECG", "electrocardiogram")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "echo", "echocardiogram")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "ocular us", "ocular ultrasound")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "
us of external mass", "ultrasound of external mass")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "
ct mri", "CT/MRI")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "
thoracic us  not echo ", "thoracic ultrasound not echocardiogram")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "
abdo us", "abdo ultrasound")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "coomb s test or in saline agglutination", "coombs test/in saline agglutination")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "ua", "urinalysis")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "cbc  biochem or lytes", "complete blood count/biochemistry/electrolytes")
df_long_diag$treatment <- str_replace(df_long_diag$treatment, "csf", "CSF")
# Scientific color palette
palette <- brewer.pal(n = 6, name = "Set3")
# Bar chart with overlaps and scientific color scheme
ggplot(df_long2, aes(x = treatment, y = count, fill = category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(. ~ category, scales = "free_x", space = "free_x") +  # Group by main categories
labs(title = "Number of Cases per Diagnostic by Group",
x = "Diagnostic",
y = "Number of Cases") +
scale_fill_manual(values = palette) +  # Use scientific color palette
theme_minimal() +  # Clean theme
theme(
axis.text.x = element_text(angle = 90, hjust = 1, size = 12),  # Larger and angled labels
axis.title = element_text(size = 12),
strip.text = element_text(size = 12),  # Larger category labels
legend.position = "none",  # Hide legend
panel.grid.major.x = element_blank()  # Remove vertical grid lines
)
# Bar chart with adjustments
diag_plot <-ggplot(df_long_diag, aes(x = treatment, y = count, fill = category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(. ~ category, scales = "free_x", space = "free_x") +  # Group by main categories
labs(title = "Number of Cases per diagnostic by Group",
x = "Diagnostic",
y = "Number of Cases") +
scale_fill_manual(values = palette) +  # Use scientific color palette
theme_minimal() +  # Clean theme
theme(
axis.text.x = element_text(angle = 90, hjust = 1, size = 10, vjust = 0.1),  # Larger and closer labels on x-axis
axis.title = element_text(size = 14),
strip.text = element_text(size = 12),  # Slightly smaller facet labels to save space
legend.position = "none",  # Hide legend
panel.grid.major.x = element_blank(),  # Remove vertical grid lines
panel.spacing = unit(0, "lines"),  # Minimize space between facets
plot.margin = unit(c(0.1, 0.1, 0, 0.1), "cm")  # Minimize bottom margin to reduce whitespace
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/diagnostics_plot.pdf", plot = diag_plot, width = 15, height = 10, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/diagnostics_plot2.pdf", plot = diag_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/clinical_signs_plot2.tif", plot = clin_plot, width = 13, height =9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/diagnostics_plot2.tif", plot = diag_plot, width = 13, height = 9, dpi = 300)
summary_table_management <- summary_table_management%>%
arrange(desc(.[[3]]))
print(summary_table_management)
# groupings
#surgery Y or N
surgery <- c("splenectomy","mass.removal","ex.lap","incisional.biopsy","liver.lobectomy","limb.or.digit.amputation","enterectomy","enucleation","sinusotomy","nephrectomy","unrecorded.surgical.procedure")
#medical management Y or N
medical <-c("palliative.analgesia","chemo","palliative.steroids","blood.product.transfusion","tranexamic.acid","autotransfusion","yunnan.baiyao","anti.seizure.medications","coriolus.versicolor..turkey.tail..mushroom","pimobendan","cbd.oil","diuretics","ferrous.sulphate","liver.support.supplement","omega.3.supplement","propanolol","thalidomide","cv247")
#medical- cardiac
med_cardiac <-c("pimobendan","diuretics","propanolol")
#medical-alternative medicine
med_alternative_supp <-c("yunnan.baiyao","coriolus.versicolor..turkey.tail..mushroom","cbd.oil","liver.support.supplement","omega.3.supplement")
#transfusion Y or N
transfusion <-c("blood.product.transfusion","autotransfusion")
#haemostatic - transexamic acid, transfusion, yunnan baiyao
#palliatives
haemostatic <-c("tranexamic.acid","blood.product.transfusion","autotransfusion","yunnan.baiyao")
palliative <-c("palliative.analgesia","palliative.steroids")
no_med <-c("no.medical.managements")
no_surgery <-c("no.surgical.procedures")
#surgical and medical management Y or N
all_groups_management <- c(surgery,medical,med_cardiac,med_alternative_supp,transfusion,haemostatic,palliative,no_med,no_surgery)
# Find unique clinical signs that are not in any group
unclassified_management <- setdiff(summary_table_management$variable, all_groups_management)
# Display unclassified clinical signs
print(unclassified_management)
chemo_any <-c("chemo.protocol_61_3.single.agent.dox","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_6.epirubicin","chemo.protocol_61_7.vincristine.cyclophosphamide.protocol","chemo.protocol_61_5.metronomic.chemo","chemo.protocol_61_3.single.agent.dox","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_6.epirubicin","chemo.protocol_61_7.vincristine.cyclophosphamide.protocol")
summary_table_management <- summary_table_management%>%
arrange(desc(.[[3]]))
print(summary_table_management)
# groupings
#surgery Y or N
surgery <- c("splenectomy","mass.removal","ex.lap","incisional.biopsy","liver.lobectomy","limb.or.digit.amputation","enterectomy","enucleation","sinusotomy","nephrectomy","unrecorded.surgical.procedure")
#medical management Y or N
medical <-c("palliative.analgesia","chemo","palliative.steroids","blood.product.transfusion","tranexamic.acid","autotransfusion","yunnan.baiyao","anti.seizure.medications","coriolus.versicolor..turkey.tail..mushroom","pimobendan","cbd.oil","diuretics","ferrous.sulphate","liver.support.supplement","omega.3.supplement","propanolol","thalidomide","cv247")
#medical- cardiac
med_cardiac <-c("pimobendan","diuretics","propanolol")
#medical-alternative medicine
med_alternative_supp <-c("yunnan.baiyao","coriolus.versicolor..turkey.tail..mushroom","cbd.oil","liver.support.supplement","omega.3.supplement")
#transfusion Y or N
transfusion <-c("blood.product.transfusion","autotransfusion")
#haemostatic - transexamic acid, transfusion, yunnan baiyao
#palliatives
haemostatic <-c("tranexamic.acid","blood.product.transfusion","autotransfusion","yunnan.baiyao")
palliative <-c("palliative.analgesia","palliative.steroids")
no_med <-c("no.medical.managements")
no_surgery <-c("no.surgical.procedures")
#surgical and medical management Y or N
all_groups_management <- c(surgery,medical,med_cardiac,med_alternative_supp,transfusion,haemostatic,palliative,no_med,no_surgery)
# Find unique clinical signs that are not in any group
unclassified_management <- setdiff(summary_table_management$variable, all_groups_management)
# Display unclassified clinical signs
print(unclassified_management)
chemo_any <-c("chemo.protocol_61_3.single.agent.dox","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_6.epirubicin","chemo.protocol_61_7.vincristine.cyclophosphamide.protocol","chemo.protocol_61_5.metronomic.chemo","chemo.protocol_61_3.single.agent.dox","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_4.dox.containing.combination","chemo.protocol_61_6.epirubicin","chemo.protocol_61_7.vincristine.cyclophosphamide.protocol")
#strip the diagnostic.tests.recorded. etc. bit from first bit of column names before applying the function to them and then only retaining the ones with >30 cases
colnames(result_df15) <- str_replace_all(colnames(result_df15), "^surgical\\.procedures\\.recorded_\\d+_\\d+\\.", "")
colnames(result_df15) <- str_replace_all(colnames(result_df15), "^medical\\.managements_\\d+_\\d+\\.", "")
#ensure all columns have a name
#now recode DF for whether each patient fits into each of these groups (0=no, 1=yes)
source("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/code/functions/grouping_presence_funct.R")
result_df16 <- result_df15 %>%
mutate(across(161:191, ~ as.numeric(.)))%>%
add_presence_column(surgery, "management_surgery_any") %>%
add_presence_column(medical, "management_medical_any") %>%
add_presence_column(med_cardiac, "management_medical_cardiac") %>%
add_presence_column(med_alternative_supp, "management_medical_alternative_supp") %>%
add_presence_column(transfusion, "management_medical_transfusion") %>%
add_presence_column(haemostatic, "management_medical_haemostatic") %>%
add_presence_column(palliative, "management_medical_palliative")%>%
add_presence_column(no_med, "management_medical_none") %>%
add_presence_column(no_surgery,"management_surgery_none")
result_df16 <- result_df16 %>%
mutate(management_medical_and_surgical = ifelse(management_surgery_any == 1 & management_medical_any == 1, 1, 0))
result_df16 <- result_df16 %>%
mutate(management_no_surgery_or_medicine = ifelse(management_surgery_none== 1 & management_medical_none == 1, 1, 0))
#df_treatments <- result_df16 %>%
#  summarise(across(c(surgery,medical,med_cardiac,med_alternative_supp,transfusion,haemostatic,palliative,no_med,no_surgery),
#                   ~ sum(. == 1)))
#remove no med and no surgery and surgery and medical as they are the bigger categories
# Create long format with category, and dynamically handle overlaps
df_treatments <- result_df16 %>%
summarise(across(c(surgery, med_cardiac, med_alternative_supp,
transfusion, haemostatic, palliative,chemo_any),
~ sum(. == 1)))
# Create a long dataframe, assigning multiple categories dynamically for overlapping treatments
df_long <- df_treatments %>%
pivot_longer(cols = everything(), names_to = "treatment", values_to = "count") %>%
mutate(category = case_when(
treatment %in% surgery ~ "Surgery",
treatment %in% med_cardiac ~ "Medical - Cardiac",
treatment %in% med_alternative_supp ~ "Medical - Alternative",
treatment %in% transfusion ~ "Transfusion",
treatment %in% haemostatic ~ "Haemostatic",
treatment %in% palliative ~ "Palliative",
treatment %in% chemo_any ~ "Chemotherapy"
))
df_long <- df_long %>%
mutate(treatment = recode(treatment,
"chemo.protocol_61_3.single.agent.dox" = "chemo.single.agent.doxirubicin",
"chemo.protocol_61_4.dox.containing.combination" = "chemo.dox.containing.combination",
"chemo.protocol_61_6.epirubicin" = "chemo.protocol.epirubicin",
"chemo.protocol_61_7.vincristine.cyclophosphamide.protocol" = "chemo.protocol.vincristine.cyclophosphamide.",
"chemo.protocol_61_5.metronomic.chemo" = "chemo.metronomic.chemo"))
# Duplicate rows for treatments appearing in more than one category
df_long <- bind_rows(
df_long,
df_long %>%
filter(treatment %in% med_alternative_supp) %>%
mutate(category = "Medical - Alternative"),
df_long %>%
filter(treatment %in% haemostatic) %>%
mutate(category = "Haemostatic"),
df_long %>%
filter(treatment %in% transfusion) %>%
mutate(category = "Transfusion")
)
# Sort treatments within each category by count
df_long <- df_long %>%
group_by(category) %>%
arrange(category, count) %>%
ungroup()
#remove incorrect duplications
df_long<- df_long %>%
distinct(treatment, category, .keep_all = TRUE)
# Sort treatments within each category by count
df_long <- df_long%>%
group_by(category) %>%
arrange(category, count) %>%
ungroup()
# Update the factor levels of the treatment to reflect the sorted order
df_long$treatment <- factor(df_long$treatment, levels = unique(df_long$treatment))
df_long_tx <- df_long
df_long_tx$treatment <- gsub("\\.", " ", df_long_tx$treatment)
df_long_tx$category <- gsub("\\.", " ", df_long_tx$category)
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "	ex lap", "exploratory laparotomy")
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "cbd oil", "CBD oil")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Alternative", "Alternative medicine")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Cardiac", "Cardiac medicine")
# Update the factor levels of the treatment to reflect the sorted order
df_long_tx$treatment <- factor(df_long_tx$treatment, levels = unique(df_long_tx$treatment))
df_long_tx$category <- factor(df_long_tx$category, levels = c("Alternative medicine","Cardiac medicine","Chemotherapy","Haemostatic","Palliative","Transfusion","Surgery"))
# Scientific color palette
palette <- brewer.pal(n = 7, name = "Set3")
# Bar chart with adjustments
tx_plot <-ggplot(df_long_tx, aes(x = treatment, y = count, fill = category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(. ~ category, scales = "free_x", space = "free_x") +  # Group by main categories
labs(title = "Number of Cases per Treatment by Group",
x = "Treatment",
y = "Number of Cases") +
scale_fill_manual(values = palette) +  # Use scientific color palette
theme_minimal() +  # Clean theme
theme(
axis.text.x = element_text(angle = 90, hjust = 1, size = 10, vjust = 0.1),  # Larger and closer labels on x-axis
axis.title = element_text(size = 14),
strip.text = element_text(size = 12),  # Slightly smaller facet labels to save space
legend.position = "none",  # Hide legend
panel.grid.major.x = element_blank(),  # Remove vertical grid lines
panel.spacing = unit(0, "lines"),  # Minimize space between facets
plot.margin = unit(c(0.1, 0.1, 0, 0.1), "cm")  # Minimize bottom margin to reduce whitespace
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot.pdf", plot = tx_plot, width = 15, height = 10, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot.pdf", plot = tx_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot.tif", plot = tx_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot.tif", plot = tx_plot, width = 13.1, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.pdf", plot = tx_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.tif", plot = tx_plot, width = 13.1, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.tif", plot = tx_plot, width = 13.5, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.tif", plot = tx_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots2.tif", plot = (clin_plot / diag_plot/ tx_plot), width = 13, height = 30,dpi=300)
library(patchwork)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots2.tif", plot = (clin_plot / diag_plot/ tx_plot), width = 13, height = 30,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot / diag_plot/ tx_plot), width = 15, height = 40,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot / diag_plot/ tx_plot), width = 25, height = 40,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot / diag_plot/ tx_plot), width = 28, height = 40,dpi=300)
base_font_size <- 16  # or try 18
clin_plot2 <- clin_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
clin_plot2
base_font_size <- 14  # or try 18
clin_plot2 <- clin_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
clin_plot2
diag_plot2 <- diag_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
diag_plot2
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
tx_plot2
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 15, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots3.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 16, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 20, height = 30,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 15, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 13, height = 17,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 15, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 12, height = 15,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 14, height = 15,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 12, height = 15,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 15, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 14,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 1),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 10),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 4)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size -1),
plot.title = element_text(size = base_font_size + 4)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size -5),
plot.title = element_text(size = base_font_size + 4)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size -2),
plot.title = element_text(size = base_font_size + 4)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 7, height = 9,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 12, height = 15,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 12,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 15,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 12, height = 20,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
clin_plot2 <- clin_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
diag_plot2 <- diag_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 10, height = 18,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 13, height = 18,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 14, height = 18,dpi=300)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 14, height = 18,dpi=300)
df_long_tx$category <- stringr::str_wrap(df_long_tx$category, width = 10)
View(df_long_tx)
df_long_tx$category <- recode(df_long_tx$category,
"Cardiac medicine" = "Cardiac\nmedicine",
"Alternative medicine" = "Alternative\nmedicine",
"Chemotherapy" = "Chemotherapy",
"Palliative"="Palliative",
"Transfusion" ="Transfusion",
"Surgery"
)
df_long_tx <- df_long
df_long_tx$treatment <- gsub("\\.", " ", df_long_tx$treatment)
df_long_tx$category <- gsub("\\.", " ", df_long_tx$category)
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "	ex lap", "exploratory laparotomy")
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "cbd oil", "CBD oil")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Alternative", "Alternative medicine")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Cardiac", "Cardiac medicine")
# Update the factor levels of the treatment to reflect the sorted order
df_long_tx$treatment <- factor(df_long_tx$treatment, levels = unique(df_long_tx$treatment))
df_long_tx$category <- recode(df_long_tx$category,
"Cardiac medicine" = "Cardiac\nmedicine",
"Alternative medicine" = "Alternative\nmedicine",
"Chemotherapy" = "Chemotherapy",
"Palliative"="Palliative",
"Transfusion" ="Transfusion",
"Surgery"
)
df_long_tx$category <- factor(df_long_tx$category, levels = c("Alternative medicine","Cardiac medicine","Chemotherapy","Haemostatic","Palliative","Transfusion","Surgery"))
df_long_tx$category <- stringr::str_wrap(df_long_tx$category, width = 10)
df_long_tx$category <- recode(df_long_tx$category,
"Cardiac medicine" = "Cardiac\nmedicine",
"Alternative medicine" = "Alternative\nmedicine",
"Chemotherapy" = "Chemotherapy",
"Palliative"="Palliative",
"Transfusion" ="Transfusion",
"Surgery"="Surgery"
)
View(df_long_tx)
df_long_tx <- df_long
df_long_tx$treatment <- gsub("\\.", " ", df_long_tx$treatment)
df_long_tx$category <- gsub("\\.", " ", df_long_tx$category)
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "	ex lap", "exploratory laparotomy")
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "cbd oil", "CBD oil")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Alternative", "Alternative medicine")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Cardiac", "Cardiac medicine")
# Update the factor levels of the treatment to reflect the sorted order
df_long_tx$treatment <- factor(df_long_tx$treatment, levels = unique(df_long_tx$treatment))
df_long_tx$category <- recode(df_long_tx$category,
"Cardiac medicine" = "Cardiac\nmedicine",
"Alternative medicine" = "Alternative\nmedicine",
"Chemotherapy" = "Chemotherapy",
"Palliative"="Palliative",
"Transfusion" ="Transfusion",
"Surgery"="Surgery"
)
df_long_tx <- df_long
df_long_tx$treatment <- gsub("\\.", " ", df_long_tx$treatment)
df_long_tx$category <- gsub("\\.", " ", df_long_tx$category)
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "	ex lap", "exploratory laparotomy")
df_long_tx$treatment <- str_replace(df_long_tx$treatment, "cbd oil", "CBD oil")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Alternative", "Alt. medicine")
df_long_tx$category <- str_replace(df_long_tx$category, "Medical - Cardiac", "Cardiac med.")
# Update the factor levels of the treatment to reflect the sorted order
df_long_tx$treatment <- factor(df_long_tx$treatment, levels = unique(df_long_tx$treatment))
df_long_tx$category <- factor(df_long_tx$category, levels = c("Alt. medicine","Cardiac med.","Chemotherapy","Haemostatic","Palliative","Transfusion","Surgery"))
# Scientific color palette
palette <- brewer.pal(n = 7, name = "Set3")
# Bar chart with adjustments
tx_plot <-ggplot(df_long_tx, aes(x = treatment, y = count, fill = category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(. ~ category, scales = "free_x", space = "free_x") +  # Group by main categories
labs(title = "Number of Cases per Treatment by Group",
x = "Treatment",
y = "Number of Cases") +
scale_fill_manual(values = palette) +  # Use scientific color palette
theme_minimal() +  # Clean theme
theme(
axis.text.x = element_text(angle = 90, hjust = 1, size = 10, vjust = 0.1),  # Larger and closer labels on x-axis
axis.title = element_text(size = 14),
strip.text = element_text(size = 12),  # Slightly smaller facet labels to save space
legend.position = "none",  # Hide legend
panel.grid.major.x = element_blank(),  # Remove vertical grid lines
panel.spacing = unit(0, "lines"),  # Minimize space between facets
plot.margin = unit(c(0.1, 0.1, 0, 0.1), "cm")  # Minimize bottom margin to reduce whitespace
)
tx_plot
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot.pdf", plot = tx_plot, width = 15, height = 10, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.pdf", plot = tx_plot, width = 13, height = 9, dpi = 300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/treatments_plot2.tif", plot = tx_plot, width = 13, height = 9, dpi = 300)
base_font_size <- 14  # or try 18
clin_plot2 <- clin_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
diag_plot2 <- diag_plot + theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
tx_plot2 <- tx_plot+ theme(
axis.text = element_text(size = base_font_size),
axis.title = element_text(size = base_font_size + 2),
strip.text = element_text(size = base_font_size),
plot.title = element_text(size = base_font_size + 2)
)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 14, height = 18,dpi=300)
ggsave("C:/Users/ctaylor18/GitHub/HSA-VC-survival-analyses/HSA-VC-survival-analyses/output/combined_group_plots4.tif", plot = (clin_plot2 / diag_plot2/ tx_plot2), width = 15, height = 17,dpi=300)
