<<<<<<< Updated upstream
<<<<<<< Updated upstream
sex== "M" ~ "Male",
sex_status == "Intact Female" ~ "Intact Female",
spayed_while_in_heat == "0" ~ "0",
spayed_while_in_heat == "1" ~"1"
))
#same as above account for unnetered and males
cohort_abr$heats_before_neutering <- as.numeric(cohort_abr$heats_before_neutering)
heats <- cohort_abr %>%
# Convert to numeric
filter(heats_before_neutering != 0) %>%
# Remove rows where the column is 0
filter(heats_before_neutering != "not_recorded")%>%
dplyr::select(heats_before_neutering)# Keep only this column
heats <- as.numeric(heats$heats_before_neutering)
# Function to calculate quartile or tercile dynamically
get_breaks <- function(x, probs) {
breaks <- quantile(x, probs = probs, na.rm = TRUE)
# If breaks are not unique, switch to tercile
if (length(unique(breaks)) < length(probs)) {
message("quartile not unique, switching to tercile.")
breaks <- quantile(x, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE)
}
return(breaks)
}
breaks <- get_breaks(heats, c(0, 0.25, 0.5, 0.75, 1))
# Assign labels dynamically
labels <- paste0("â‰¥", round(head(breaks, -1), 2), " - <", round(tail(breaks, -1), 2))
cohort_abr <- cohort_abr %>%
mutate(heats_before_neutering_tercile = case_when(
sex== "M" ~ "Male",
sex_status == "Intact Female" ~ "Intact Female",
heats_before_neutering == "0" ~ "0",
heats_before_neutering == "1" ~"1-<=2",
heats_before_neutering == "2" ~"1-<=2",
heats_before_neutering == "3" ~">2-<=4",
heats_before_neutering == "4" ~">2-<=4",
heats_before_neutering == "5" ~">4-12",
heats_before_neutering == "6" ~">4-12",
heats_before_neutering == "7" ~">4-12",
heats_before_neutering == "8" ~">4-12",
heats_before_neutering == "9" ~">4-12",
heats_before_neutering == "10" ~">4-12",
heats_before_neutering == "11" ~">4-12",
heats_before_neutering == "12" ~">4-12"
))
#create combined sex neuter variable
cohort_abr <- cohort_abr %>%
mutate(sex_neuter = paste(sex, neuter, sep = " "))
#ensure not_recorded is default not baseline
convert_and_relevel <- function(df) {
df <- df %>%
mutate(across(where(is.character), ~ factor(.))) %>%  # Convert all character columns to factors
mutate(across(where(is.factor), ~ fct_relevel(., "not_recorded", after = Inf)))  # Move "not_recorded" to last place
return(df)
}
# Apply to your dataset
cohort_abr <- convert_and_relevel(cohort_abr)
cohort_abr <- cohort_abr%>%
mutate(heats_before_neutering_tercile = factor(heats_before_neutering_tercile, levels = c("0", "1-<=2", ">2-<=4", ">4-12","Intact Female","Male","not_recorded")))
#neuter reason levels
cohort_abr <- cohort_abr%>%
mutate(neutered_reason = factor(neutered_reason, levels = c("Elective",  "Medical Reason", "Entire","Unknown")))
cohort_abr <- cohort_abr%>%
mutate(mode_purina_BCS_5y_prior_endpoint = factor(mode_purina_BCS_5y_prior_endpoint, levels = c("5", "3", "4", "6","7","8","9","not_recorded")))
#change BCS to be over underweight
cohort_abr <- cohort_abr %>%
mutate(mode_BCS_classify = case_when(
mode_purina_BCS_5y_prior_endpoint == "1" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "2" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "3" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "4" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "5" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "6" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "7" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "8" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "9" ~"overweight",
))
#set age levels
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years")))
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_bio = factor(age_at_final_date_bio, levels = c(">5-<8y","<5y",  ">8-<11y", ">11-<13y",">13y")))
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_GB = factor(age_at_final_date_GB, levels = c(">7-<9y","<5y", ">5-<7y",  ">9-<11y",">11-<13y",">13y")))
#manually assign height, weight, BCS factor levles and age at neuter and age at diagnosis
#height
cohort_abr <- cohort_abr%>%
mutate(avg_height_5y_prior_endpoint_quartiles = factor(avg_height_5y_prior_endpoint_quartiles, levels = c("49.80-<56.30cm", ">=56.30-<58.29cm", ">=58.29-<60.32cm", ">=60.32cm-67.73cm","not_recorded")))
#weight
cohort_abr <- cohort_abr%>%
mutate(avg_weight_5y_prior_endpoint_quartiles = factor(avg_weight_5y_prior_endpoint_quartiles, levels = c("12.47-<20.83kg", ">=20.83-<23.23kg", ">=23.23-26.98kg", ">=26.98-37.01","not_recorded")))
#recoding weight levels here so the <15kg dogs are now "not_recorded"
cohort_abr <- cohort_abr %>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = case_when(
avg_weight_5y_prior_endpoint_kg_biological == "<15kg" ~ "not_recorded",
TRUE ~ avg_weight_5y_prior_endpoint_kg_biological
))
cohort_abr <- cohort_abr%>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = factor(avg_weight_5y_prior_endpoint_kg_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median any records in 5y
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles, levels = c("10.5-<17.1kg", ">=17.1-<24.7kg", ">=24.7-30.6kg", ">=30.6-49.1kg","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median all 5 record years
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles, levels = c("10.5-<16.1kg", ">=16.1-<21.3kg", ">=21.3-28.8kg", ">=28.8-47.1kg","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(avg_purina_BCS_5y_prior_endpoint_quartiles = factor(avg_purina_BCS_5y_prior_endpoint_quartiles, levels = c("3.3-<5", ">=5-<5.28", ">=5.28-<5.86", ">=5.86 - 9","not_recorded")))
#neut age
cohort_abr <- cohort_abr%>%
mutate(age_at_neuter_years_quartiles = factor(age_at_neuter_years_quartiles, levels = c("0.15-<0.52y", ">=0.52-<0.83y", ">=0.83-2.44y", ">=2.44-9.59y","Entire","not_recorded")))
#diagnosis age
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years","not_recorded")))
#breed tercile levels
cohort_abr <- cohort_abr%>%
mutate(num_breeding_before_neutering_terciles = factor(num_breeding_before_neutering_terciles, levels = c(">0-<3",">=3-<9",">=9-142","not_bred","not_recorded")))
#recode NSAID quartiles
cohort_abr <- cohort_abr%>%
mutate(NSAID_5y_quantiles = factor(NSAID_5y_quantiles, levels = c("no_NSAID_admin", "Q1(1)", "Q2(1-2)", "Q3(2-3)","Q4(3-11)","no_med_use_recorded")))
cohort_abr <- cohort_abr%>%
mutate(endo_5y_quantiles = factor(endo_5y_quantiles, levels = c("no_endo_admin", "Q1(1-2)", "Q2(2-3)", "Q3(3-4)","Q4(4-17)","no_med_use_recorded")))
cohort_abr <- cohort_abr%>%
mutate(ecto_5y_quantiles = factor(ecto_5y_quantiles, levels = c("no_ecto_admin", "Q1(1)", "Q2(1-2)", "Q3(2-4)","Q4(4-17)","no_med_use_recorded")))
###setting "no_medication_records_for_this_time_periodistered" as bottom factor level for drug variables as think it actually means drug use not recorded so doesnt make a good baseline
# Vector of the column names to modify
# Suppose you want to modify columns 3 to 17, for example
cols_to_modify <- 198:265  # replace with your actual column indices
for (i in cols_to_modify) {
current_levels <- levels(cohort_abr[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_abr[[i]] <- factor(cohort_abr[[i]], levels = new_levels)
}
}
#SY1 and 2
cohort_abr <- cohort_abr %>%
mutate(avg_activity_duration_sy1_2 = as.numeric(as.character(avg_activity_duration_sy1_2))) %>%
mutate(avg_activity_duration_sy1_2_splits = case_when(
avg_activity_duration_sy1_2 <= 20 ~ "less_than_30min",
avg_activity_duration_sy1_2 >20 & avg_activity_duration_sy1_2 <= 40 ~ "between_30_60_min",
avg_activity_duration_sy1_2 >40 & avg_activity_duration_sy1_2<= 60 ~ "between_60_90_min",
avg_activity_duration_sy1_2 >60 & avg_activity_duration_sy1_2 <= 80 ~ "between_90_120_min",
avg_activity_duration_sy1_2 >80 & avg_activity_duration_sy1_2 <= 100 ~ "more_than_120_min"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy1_2 = as.numeric(as.character(avg_activity_freq_sy1_2))) %>%
mutate(avg_activity_freq_sy1_2_splits = case_when(
avg_activity_freq_sy1_2 <= 20 ~ "never",
avg_activity_freq_sy1_2 >20 & avg_activity_freq_sy1_2<= 40 ~ "less_than_weekly",
avg_activity_freq_sy1_2 >40 & avg_activity_freq_sy1_2<= 60 ~ "min_weekly",
avg_activity_freq_sy1_2 >60 & avg_activity_freq_sy1_2 <= 80 ~ "daily",
avg_activity_freq_sy1_2 >80 & avg_activity_freq_sy1_2<= 100 ~ "multi_daily"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy1_2 = as.numeric(as.character(avg_activity_intensity_sy1_2))) %>%
mutate(avg_activity_intensity_sy1_2_splits = case_when(
avg_activity_intensity_sy1_2 <= 33.3 ~ "low",
avg_activity_intensity_sy1_2 >33.3 & avg_activity_intensity_sy1_2<= 66.7 ~ "moderate",
avg_activity_intensity_sy1_2 >66.7 & avg_activity_intensity_sy1_2<= 100 ~ "high",
))
#SY3 + intensity and freq
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy3 = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_activity_freq_sy3_splits = case_when(
avg_activity_freq_sy3 <= 20 ~ "rarely",
avg_activity_freq_sy3 >20 & avg_activity_freq_sy3<= 40 ~ "monthly",
avg_activity_freq_sy3 >40 & avg_activity_freq_sy3<= 60 ~ "weekly",
avg_activity_freq_sy3 >60 & avg_activity_freq_sy3 <= 80 ~ "daily",
avg_activity_freq_sy3 >80 & avg_activity_freq_sy3<= 100 ~ "multi_daily"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy3 = as.numeric(as.character(avg_activity_intensity_sy3))) %>%
mutate(avg_activity_intensity_sy3_splits = case_when(
avg_activity_intensity_sy3 <= 20 ~ "slow_walks",
avg_activity_intensity_sy3 >20 & avg_activity_intensity_sy3<= 40 ~ "average_walks",
avg_activity_intensity_sy3 >40 & avg_activity_intensity_sy3<= 60 ~ "brisk_walks",
avg_activity_intensity_sy3 >60 & avg_activity_intensity_sy3 <= 80 ~ "jogs",
avg_activity_intensity_sy3 >80 & avg_activity_intensity_sy3<= 100 ~ "runs"
))
#5y prior endpoint  freq
cohort_abr <- cohort_abr %>%
mutate(avg_frequency_5y_prior_endpoint = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_frequency_5y_prior_endpoint_splits = case_when(
avg_frequency_5y_prior_endpoint <= 20 ~ "rarely",
avg_frequency_5y_prior_endpoint >20 & avg_frequency_5y_prior_endpoint<= 40 ~ "monthly",
avg_frequency_5y_prior_endpoint >40 & avg_frequency_5y_prior_endpoint<= 60 ~ "weekly",
avg_frequency_5y_prior_endpoint >60 & avg_frequency_5y_prior_endpoint <= 80 ~ "daily",
avg_frequency_5y_prior_endpoint >80 &avg_frequency_5y_prior_endpoint<= 100 ~ "multi_daily"
))
#5y prior endpoint intensity
cohort_abr <- cohort_abr %>%
mutate(avg_intensity_5y_prior_endpoint = as.numeric(as.character(avg_intensity_5y_prior_endpoint))) %>%
mutate(avg_intensity_5y_prior_endpoint_splits = case_when(
avg_intensity_5y_prior_endpoint <= 20 ~ "slow_walks",
avg_intensity_5y_prior_endpoint >20 & avg_intensity_5y_prior_endpoint<= 40 ~ "average_walks",
avg_intensity_5y_prior_endpoint >40 & avg_intensity_5y_prior_endpoint<= 60 ~ "brisk_walks",
avg_intensity_5y_prior_endpoint >60 & avg_intensity_5y_prior_endpoint <= 80 ~ "jogs",
avg_intensity_5y_prior_endpoint >80 & avg_intensity_5y_prior_endpoint<= 100 ~ "runs"
))
#recode into larger groupings e.g grouping together rarely + monthly for frequency
#freq
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy3_splits_grouped = case_when(
avg_activity_freq_sy3_splits == "monthly" ~ "rarely",
avg_activity_freq_sy3_splits == "multi_daily"~"daily_or_more" ,
avg_activity_freq_sy3_splits == "daily" ~"daily_or_more" ,
avg_activity_freq_sy3_splits == "weekly" ~"weekly" ,
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
))
#intensity
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy3_splits_grouped = case_when(
avg_activity_intensity_sy3_splits == "jogs" ~ "high_intensity",
avg_activity_intensity_sy3_splits == "runs" ~"high_intensity" ,
avg_activity_intensity_sy3_splits == "brisk_walks" ~"moderate_intensity",
avg_activity_intensity_sy3_splits =="average_walks" ~ "low_intensity",
avg_activity_intensity_sy3_splits =="slow_walks" ~ "low_intensity"
))
#5y prior freq
cohort_abr <- cohort_abr %>%
mutate(avg_frequency_5y_prior_endpoint_splits_grouped = case_when(
avg_frequency_5y_prior_endpoint_splits == "monthly" ~ "rarely",
avg_frequency_5y_prior_endpoint_splits == "multi_daily"~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "daily" ~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "weekly" ~"weekly" ,
avg_frequency_5y_prior_endpoint_splits == "rarely" ~"rarely" ,
))
#5y prior intensity
cohort_abr <- cohort_abr %>%
mutate(avg_intensity_5y_prior_endpoint_splits_grouped = case_when(
avg_intensity_5y_prior_endpoint_splits == "jogs" ~ "high_intensity",
avg_intensity_5y_prior_endpoint_splits == "runs" ~"high_intensity" ,
avg_intensity_5y_prior_endpoint_splits == "brisk_walks" ~"moderate_intensity",
avg_intensity_5y_prior_endpoint_splits =="average_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="slow_walks" ~ "low_intensity"
))
#swap not_recorded for NA and exclude from univar this way
cohort_no_not_rec <- cohort_abr %>%
mutate(across(
where(~ is.character(.) | is.factor(.)),
~ factor(na_if(as.character(.), "not_recorded"))
))
dependent <- "had_HSA"
# All other variables as explanatory variables
explanatory = c(
#demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles",
"avg_purina_BCS_5y_prior_endpoint_quartiles","median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","NSAID_5y_quantiles","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever","ecto_5y_quantiles","endo_5y_quantiles"
)
# Create a univariable logistic regression table
univar_table <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,column = TRUE)
#column = TRUE does case and contorl counts for each variable category rather than rowise
univar_table2 <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,na_include = TRUE,column=TRUE)
# View the results
print(univar_table)
write.csv(univar_table,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.csv")
#save as worddoc
# Install and load the required packages
library(officer)
library(flextable)
# Create a Word document
doc <- read_docx()
# Convert finalfit output to a flextable
results_flextable <- flextable(univar_table)
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
# Save the Word document
print(doc, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.docx")
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_auto.R")
cohort_abr$had_HSA <- as.factor(cohort_abr$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_abr2 <- cohort_abr %>%
dplyr::select(   #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles", "median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max"
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_auto.R")
cohort_abr$had_HSA <- as.factor(cohort_abr$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_abr2 <- cohort_abr %>%
dplyr::select(   #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles", "median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","NSAID_5y_quantiles","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever", "ecto_5y_quantiles","endo_5y_quantiles","had_HSA")
cohort_abr2<- cohort_abr2%>%
mutate_all(~factor(ifelse(is.na(.), "not_recorded", as.character(.))))
cohort_abr2 <- cohort_abr2%>%
mutate(heats_before_neutering_terciles = factor(heats_before_neutering_terciles, levels = c("0", "1-<=2", ">2-<=4", ">4-12","Intact Female","Male","not_recorded")))
#neuter reason levels
cohort_abr2<- cohort_abr2%>%
mutate(neutered_reason = factor(neutered_reason, levels = c("Elective",  "Medical Reason", "Entire","Unknown","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(mode_purina_BCS_5y_prior_endpoint = factor(mode_purina_BCS_5y_prior_endpoint, levels = c("5", "3", "4", "6","7","8","9","not_recorded")))
#change BCS to be over underweight
cohort_abr2 <- cohort_abr2 %>%
mutate(mode_BCS_classify = case_when(
mode_purina_BCS_5y_prior_endpoint == "1" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "2" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "3" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "4" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "5" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "6" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "7" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "8" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "9" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "not_recorded" ~"not_recorded",
))
#set age levels
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_bio = factor(age_at_final_date_bio, levels = c(">5-<8y","<5y",  ">8-<11y", ">11-<13y",">13y")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_GB = factor(age_at_final_date_GB, levels = c(">7-<9y","<5y", ">5-<7y",  ">9-<11y",">11-<13y",">13y")))
#manually assign height, weight, BCS factor levles and age at neuter and age at diagnosis
#height
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_quartiles = factor(avg_weight_5y_prior_endpoint_quartiles, levels = c("12.47-<20.83kg", ">=20.83-<23.23kg", ">=23.23-26.98kg", ">=26.98-37.01","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = factor(avg_weight_5y_prior_endpoint_kg_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles, levels = c("10.5-<17.1kg", ">=17.1-<24.7kg", ">=24.7-30.6kg", ">=30.6-49.1kg","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median all 5 record years
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles, levels = c("10.5-<16.1kg", ">=16.1-<21.3kg", ">=21.3-28.8kg", ">=28.8-47.1kg","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#bcs
cohort_abr2 <- cohort_abr2%>%
mutate(avg_purina_BCS_5y_prior_endpoint_quartiles = factor(avg_purina_BCS_5y_prior_endpoint_quartiles, levels = c("3.3-<5", ">=5-<5.28", ">=5.28-<5.86", ">=5.86 - 9","not_recorded")))
#neut age
cohort_abr2<- cohort_abr2 %>%
mutate(age_at_neuter_years_quartiles = factor(age_at_neuter_years_quartiles, levels = c("0.15-<0.52y", ">=0.52-<0.83y", ">=0.83-2.44y", ">=2.44-9.59y","Entire","not_recorded")))
#diagnosis age
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years","not_recorded")))
#breed tercile levels
cohort_abr2 <- cohort_abr2%>%
mutate(num_breeding_before_neutering_terciles = factor(num_breeding_before_neutering_terciles, levels = c(">0-<3",">=3-<9",">=9-142","not_bred","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(NSAID_5y_quantiles = factor(NSAID_5y_quantiles, levels = c("no_NSAID_admin", "Q1(1)", "Q2(1-2)", "Q3(2-3)","Q4(3-11)","no_med_use_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(endo_5y_quantiles = factor(endo_5y_quantiles, levels = c("no_endo_admin", "Q1(1-2)", "Q2(2-3)", "Q3(3-4)","Q4(4-17)","no_med_use_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(ecto_5y_quantiles = factor(ecto_5y_quantiles, levels = c("no_ecto_admin", "Q1(1)", "Q2(1-2)", "Q3(2-4)","Q4(4-17)","no_med_use_recorded")))
cols_to_modify <- 151:200 # replace with your actual column indices
for (i in cols_to_modify) {
current_levels <- levels(cohort_abr2[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_abr2[[i]] <- factor(cohort_abr2[[i]], levels = new_levels)
}
}
#need to set the activity splits into ordinal format
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy3_splits = factor(avg_activity_freq_sy3_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy1_2_splits = factor(avg_activity_freq_sy1_2_splits, levels = c("never","less_than_weekly","min_weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_duration_sy1_2_splits = factor(avg_activity_duration_sy1_2_splits, levels = c("less_than_30min","between_30_60_min","between_60_90_min","between_90_120_min","more_than_120_min","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_intensity_sy3_splits = factor(avg_activity_intensity_sy3_splits, levels = c("slow_walks","average_walks","brisk_walks","jogs","runs","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_frequency_5y_prior_endpoint_splits = factor(avg_frequency_5y_prior_endpoint_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
# Now run the function
univar_results <- univar_logistic_regression(cohort_abr2, "had_HSA", explanatory)
=======
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(median_weight_5y_prior_endpoint_kg = if_else(age_at_final_date < 1.5, NA_real_, median_weight_5y_prior_endpoint_kg))
#avg height to cm
#avg height to cm
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(avg_height_5y_prior_endpoint_cm = avg_height_5y_prior_endpoint * 2.54)
#### remove height values for dogs that have their age at final date as <18m (ie. non adult heights) = 6 dogs
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
mutate(avg_height_5y_prior_endpoint_cm = if_else(age_at_final_date < 1.5, NA_real_, avg_height_5y_prior_endpoint_cm))
#median
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(median_height_5y_prior_endpoint_cm = median_height_5y_prior_endpoint * 2.54)
#### remove height values for dogs that have their age at final date as <18m (ie. non adult heights) = 6 dogs
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
mutate(median_height_5y_prior_endpoint_cm = if_else(age_at_final_date < 1.5, NA_real_, median_height_5y_prior_endpoint_cm))
#keep only distinct rows
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
distinct(subject_id,.keep_all = TRUE)
#for some reason, losing records of ~23 dogs with this distinct function - take weight data and re-add to last 3044 df
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_abr <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
dplyr::select(subject_id,276:286)
#rejoin back
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3 %>% left_join(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_abr,by="subject_id")
write.csv(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_lymphoma_variables_dataset_interim.csv")
#activity data from study y 1 and 2
activity_sy1_2 <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_details_through_SY2.csv")
#check # dogs in it
act_1_2 <- unique(activity_sy1_2$subject_id)
#activity data from study y 3 +
activity_sy3_beyond <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_details_SY3_beyond.csv")
act_3_plus<- unique(activity_sy3_beyond$subject_id)
#activity overview dataset
activity_overview<- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_overview.csv")
act_over<-unique(activity_overview$subject_id)
#create a new column of total activity to include both lead walk and off lead activity
activity_sy1_2 <- activity_sy1_2 %>%
mutate(total_activity_duration = paste(walk_duration,aerobic_duration,  sep = "_")) %>%
mutate(total_activity_freq= paste(walk_frequency,aerobic_frequency,sep="_")) %>%
mutate(total_activity_intensity =paste(walk_pace,aerobic_pace,sep="_"))
#check all dogs have sy1_2 recorded - they do
unique_actsy1_2 <- unique(activity_sy1_2$subject_id)
#duration recoding
less_than_30min <- c("_10-30 minutes", "10-30 minutes_","Less than 10 minutes_","Less than 10 minutes_Less than 10 minutes","_Less than 10 minutes","10-30 minutes_Less than 10 minutes","_")
#
between_31_60min <-c("_30-60 minutes","10-30 minutes_30-60 minutes","30-60 minutes_","Less than 10 minutes_10-30 minutes","10-30 minutes_10-30 minutes","30-60 minutes_Less than 10 minutes","Less than 10 minutes_30-60 minutes","30-60 minutes_10-30 minutes")
#
between_61_90min<- c("Greater than 60 minutes_","_Greater than 60 minute","10-30 minutes_Greater than 60 minutes","Greater than 60 minutes_10-30 minutes","_Greater than 60 minutes","Greater than 60 minutes_Less than 10 minutes","Greater than 60 minutes_Less than 10 minutes","Less than 10 minutes_Greater than 60 minutes")
#
between_91_120min <- c("Greater than 60 minutes_30-60 minutes","30-60 minutes_Greater than 60 minutes","30-60 minutes_30-60 minutes")
#
more_than_120min<- c("Greater than 60 minutes_Greater than 60 minutes")
all_groups <- c(less_than_30min,between_31_60min,between_61_90min,
between_91_120min,more_than_120min)
# Find any cateogories that are not in any group
duration <- setdiff(activity_sy1_2$total_activity_duration, all_groups)
# Display unclassified clinical signs
print(duration)
#recode in df
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_duration_regroup = case_when(
total_activity_duration %in% less_than_30min ~ "less_than_30min",
total_activity_duration %in% between_31_60min ~ "between_31_60min",
total_activity_duration %in% between_61_90min ~ "between_61_90min",
total_activity_duration %in% between_91_120min ~ "between_91_120min",
total_activity_duration %in% more_than_120min ~ "more_than_120min",
TRUE ~ "no_duration_recorded" # For values not in any group
)
)
#frequency recoding
never <- c("Never_","Never_Less than once/month")
less_than_weekly <- c("Less than once/month_","Less than once/month_Less than once/month", "Less than once/month_Less than once/week","Less than once/week_Less than once/month","Never_Less than once/week","Less than once/week_",
"Less than once/week_Less than once/week")
min_weekly<-c("Once or twice/week_Once or twice/week","Once or twice/week_","Never_Once or twice/week","Once or twice/week_Less than once/month",
"Once or twice/week_Less than once/week","Less than once/week_Once or twice/week","Less than once/month_Once or twice/week")
daily<-c("Once/day_","Less than once/week_Once/day","Never_Once/day", "Once or twice/week_Once/day","Once/day_Once or twice/week","Once/day_Less than once/week",
"Once/day_Less than once/month","Once/day_Once or twice/week",
"Once/day_Less than once/week", "Once/day_Less than once/month",
"Once or twice/week_Once/day","Less than once/month_Once/day"
)
multi_daily <-c("Once/day_Once/day","Once/day_More than once a day","More than once a day_","Once or twice/week_More than once a day","Less than once/month_More than once a day","More than once a day_Once/day","Never_More than once a day","More than once a day_Less than once/month","More than once a day_Once or twice/week","Less than once/week_More than once a day","More than once a day_More than once a day",
"More than once a day_Less than once/week")
all_groups_freq <- c(never,less_than_weekly,min_weekly,daily,multi_daily)
freq <- setdiff(activity_sy1_2$total_activity_freq, all_groups_freq)
# Display unclassified freq
print(freq)
#recode in df
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_freq_regroup = case_when(
total_activity_freq %in% never ~ "never",
total_activity_freq %in% less_than_weekly ~ "less_than_weekly",
total_activity_freq %in% min_weekly ~ "min_weekly",
total_activity_freq %in% daily ~ "daily",
total_activity_freq %in% multi_daily ~ "multi_daily",
TRUE ~ "no_freq_recorded" # For values not in any group
)
)
#create recoded freq column
#intensity recoding
low_only <-c("_Bursts of exercise less than 30% of the time","Slow_","Slow_Bursts of exercise less than 30% of the time"
)
moderate <-c("Average_","_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Brisk_","Brisk_Bursts of exercise less than 30% of the time","Average_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Jog_","Average_Bursts of exercise less than 30% of the time","Jog_Bursts of exercise less than 30% of the time","Brisk_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Slow_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)")
high <-c(" _Engages in strenuous exercise most of the time (greater than 60%)","Run_","Average_Engages in strenuous exercise most of the time (greater than 60%)","Brisk_Engages in strenuous exercise most of the time (greater than 60%)","_Engages in strenuous exercise most of the time (greater than 60%)","Jog_Engages in strenuous exercise most of the time (greater than 60%)","Run_Engages in strenuous exercise most of the time (greater than 60%)","Run_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)", "Slow_Engages in strenuous exercise most of the time (greater than 60%)",
"Jog_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Run_Bursts of exercise less than 30% of the time")
all_groups_int <- c(low_only,moderate,high)
int <- setdiff(activity_sy1_2$total_activity_intensity, all_groups_int)
print(int)
#create recoded intensity column
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_intensity_regroup = case_when(
total_activity_intensity %in% low_only ~ "low_int",
total_activity_intensity %in% moderate ~ "mod_int",
total_activity_intensity %in% high ~ "high_int",
TRUE ~ "no_int_recorded" # For values not in any group
)
)
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_duration_regroup_num = case_when(
total_activity_duration %in% less_than_30min ~ "20",
total_activity_duration %in% between_31_60min ~ "40",
total_activity_duration %in% between_61_90min ~ "60",
total_activity_duration %in% between_91_120min ~ "80",
total_activity_duration %in% more_than_120min ~ "100",
TRUE ~ "0" # For values not in any group
)
)
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_freq_regroup_num = case_when(
total_activity_freq %in% never ~ "20",
total_activity_freq %in% less_than_weekly ~ "40",
total_activity_freq %in% min_weekly ~ "60",
total_activity_freq %in% daily ~ "80",
total_activity_freq %in% multi_daily ~ "100",
TRUE ~ "0" # For values not in any group
)
)
#create recoded intensity column
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_intensity_regroup_num = case_when(
total_activity_intensity %in% low_only ~ "33.3",
total_activity_intensity %in% moderate ~ "66.7",
total_activity_intensity %in% high ~ "100",
TRUE ~ "0" # For values not in any group
)
)
#create column for USDA activity <30min or >30 min
activity_sy1_2 <- activity_sy1_2 %>%
mutate(USDA_30min = case_when (
total_activity_duration_regroup %in% c("less_than_30min") ~ "below_USDA",  total_activity_duration_regroup %in% c("between_31_60min", "between_61_90min","between_91_120min","more_than_120min") ~ "more_than_USDA",
TRUE ~ NA ))
#create column for UKKC recommendaiton <2h but cannot do this one so >1h
activity_sy1_2 <- activity_sy1_2 %>%
mutate(activity_1h_min = case_when (
total_activity_duration_regroup %in% c("less_than_30min","between_31_60min") ~ "below_1h",  total_activity_duration_regroup %in% c("between_61_90min","between_91_120min","more_than_120min") ~ "more_than_1h",
TRUE ~ NA ))
activity_sy1_2 <- activity_sy1_2 %>%
mutate(activity_KC_2h_min = case_when (
total_activity_duration_regroup %in% c("less_than_30min","between_31_60min","between_61_90min","between_91_120min") ~ "below_KC",  total_activity_duration_regroup %in% c("more_than_120min") ~ "more_than_KC",
TRUE ~ NA ))
#convert to numeric for score systems
activity_sy1_2 <- activity_sy1_2 %>%
mutate(across(24:26, as.numeric))
totals_avg <- activity_sy1_2 %>%
group_by(subject_id) %>%
summarise(
avg_activity_duration = (mean(sum(total_activity_duration_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100,
avg_activity_intensity = (mean(sum(total_activity_intensity_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100,
avg_activity_freq = (mean(sum(total_activity_freq_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100
)
# Join the average values back to the original dataset
activity_sy1_2 <- activity_sy1_2 %>%
left_join(totals_avg, by = "subject_id")
#check unique IDs in SY3+ to check all dogs have records - they do not, approx 400 dogs missing records so need to account for this later on when adding back to 3044 dog df
unique_sy3 <- unique(activity_sy3_beyond$subject_id)
activity_sy3_beyond <- activity_sy3_beyond %>%
mutate(pace_num = case_when(
pace == "Slow walk" ~ 20,
pace == "Average walk" ~ 40,
pace == "Brisk walk" ~ 60,
pace == "Jog" ~ 80,
pace == "Run" ~ 100,
pace == "" ~ 0  # empty cells replace with 0 for calculation purposes
))
activity_sy3_beyond <- activity_sy3_beyond %>%
mutate(frequency_num = case_when(
frequency == "Rarely" ~ 20,
frequency == "Monthly" ~ 40,
frequency == "Weekly" ~ 60,
frequency == "Daily" ~ 80,
frequency == "More than daily" ~ 100,
frequency == "" ~ 0  # empty cells replace with 0 for calculation purposes
))
totals_y3 <- activity_sy3_beyond %>%
group_by(subject_id) %>%
summarise(
# avg_activity_duration = (mean(duration_num, na.rm = TRUE)/
#                          (n() * 100)) * 100,
avg_activity_intensity = (mean(pace_num, na.rm = TRUE)/
(n() * 100)) * 100,
avg_activity_freq=(mean(frequency_num,na.rm=TRUE)/
(n() * 100)) * 100# Replace with your column
)
# Join the totals back to the original dataset
activity_sy3_beyond <- activity_sy3_beyond %>%
left_join(totals_y3, by = "subject_id")
activity_overview <- activity_overview %>%
mutate(activity_level_num = case_when(
activity_level == "None" ~ 25,
activity_level == "Little" ~ 50,
activity_level == "Moderate" ~ 75,
activity_level == "Very active" ~ 100,
activity_level == "" ~ 0)
)
totals <- activity_overview %>%
group_by(subject_id) %>%
summarise(mean_activity_level=(mean(activity_level_num, na.rm=TRUE)/(n() * 100)) * 100)
# Join the totals back to the original dataset
activity_overview <- activity_overview %>%
left_join(totals, by = "subject_id")
activity_sy1_2_abr_3 <- activity_sy1_2 %>%
dplyr::select(c(subject_id,year_in_study, USDA_30min,activity_1h_min,activity_KC_2h_min,avg_activity_duration,avg_activity_intensity,avg_activity_freq))
activity_sy3_beyond_abr_3 <- activity_sy3_beyond %>%
dplyr::select(c(subject_id,year_in_study,
#frequency,pace,duration,frequency_num,pace_num,duration_num,<- not keeping as multi rows same year
avg_activity_freq,avg_activity_intensity))
activity_overview_abr_3 <- activity_overview %>%
dplyr::select(c(subject_id,year_in_study,mean_activity_level))
activity_sy1_2_abr_3 <- activity_sy1_2_abr_3 %>%
distinct(subject_id, .keep_all = TRUE)  %>%
# mutate(study_year = "y1_2")%>%
rename_with(~ paste0(., "_sy1_2"), .cols = 3:8)%>%
dplyr::select(-c(year_in_study))
#sy 3+
activity_sy3_beyond_abr_3 <- activity_sy3_beyond_abr_3 %>%
distinct(subject_id,  .keep_all = TRUE)  %>%
#  mutate(study_year = "y3_on")%>%
rename_with(~ paste0(., "_sy3"), .cols = 3:4)%>%
dplyr::select(-c(year_in_study))
#overview
activity_overview_abr_3 <- activity_overview_abr_3 %>%
distinct(subject_id, .keep_all = TRUE)  %>%
# mutate(study_year="all_years") %>%
rename_with(~ paste0(., "_overview"), .cols = 3:3)%>%
dplyr::select(-c(year_in_study))
activity_all_3 <- activity_overview_abr_3 %>%
left_join(activity_sy1_2_abr_3, by= "subject_id")
activity_all_3_3 <- activity_all_3 %>%
left_join(activity_sy3_beyond_abr_3,by="subject_id")
#NAs recode as "no_records_available" for the SY3
activity_all_3_3 <- activity_all_3_3 %>%
mutate(across(9:10, ~case_when(
is.na(.) ~ "no_records_for_this_time_period",
TRUE ~ as.character(.)
)))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique %>%
dplyr::select(-c(year_in_study.x,year_in_study.y,record_date.y))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique %>%
left_join(activity_all_3_3, by="subject_id")
#keep SY0-2 and SY3 beyond same cols only
activity_sy1_2_same <- activity_sy1_2 %>%
dplyr::select(c(subject_id,year_in_study,total_activity_intensity_regroup_num,total_activity_freq_regroup_num))
#rename cols to match SY3
activity_sy1_2_same <- activity_sy1_2_same %>%
rename(pace_num = total_activity_intensity_regroup_num, frequency_num = total_activity_freq_regroup_num)
activity_sy3_same<- activity_sy3_beyond %>%
dplyr::select(c(subject_id,year_in_study,pace_num,frequency_num))
activity_all_y_all_rows <- rbind(activity_sy1_2_same,activity_sy3_same)
#join to cohort for 5y backwards calculations
#abridge cohort to only keep relevant columns then join back to ~200 col df after
cohort_abr <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity %>%
dplyr::select(c(subject_id,end_date2,lymphoma,year_in_study_diagnosis_or_final_record_year))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows <- activity_all_y_all_rows %>%
left_join(cohort_abr,by="subject_id")
#many to many match from step above resolved by only keeping unique row for each patient
#only singhle unique row per patient]
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows[!duplicated(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows), ]
#make sure year is in numeric
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2$year_in_study_diagnosis_or_final_record_year  <- as.numeric(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2$year_in_study_diagnosis_or_final_record_year )
cohort_5y_prior <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2 %>%
group_by(subject_id) %>%
filter(year_in_study >= (year_in_study_diagnosis_or_final_record_year - 5)) %>%
summarise(
avg_intensity_5y_prior_endpoint = mean(pace_num, na.rm = TRUE),
avg_frequency_5y_prior_endpoint = mean(frequency_num, na.rm = TRUE),
.groups = "drop"
)
#combine all the activity data back again
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity %>%
left_join(cohort_5y_prior, by="subject_id")
#for any dogs with NAs recode "reocrds_not_available"
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(across(287:288, ~case_when(
is.na(.) ~ "no_records_for_this_time_period",
TRUE ~ as.character(.)
)))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_duration_sy1_2 = as.numeric(as.character(avg_activity_duration_sy1_2))) %>%
mutate(avg_activity_duration_sy1_2_splits = case_when(
avg_activity_duration_sy1_2 <= 20 ~ "less_than_30min",
avg_activity_duration_sy1_2 >20 & avg_activity_duration_sy1_2 <= 40 ~ "between_30_60_min",
avg_activity_duration_sy1_2 >40 & avg_activity_duration_sy1_2<= 60 ~ "between_60_90_min",
avg_activity_duration_sy1_2 >60 & avg_activity_duration_sy1_2 <= 80 ~ "between_90_120_min",
avg_activity_duration_sy1_2 >80 & avg_activity_duration_sy1_2 <= 100 ~ "more_than_120_min"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy1_2 = as.numeric(as.character(avg_activity_freq_sy1_2))) %>%
mutate(avg_activity_freq_sy1_2_splits = case_when(
avg_activity_freq_sy1_2 <= 20 ~ "never",
avg_activity_freq_sy1_2 >20 & avg_activity_freq_sy1_2<= 40 ~ "less_than_weekly",
avg_activity_freq_sy1_2 >40 & avg_activity_freq_sy1_2<= 60 ~ "min_weekly",
avg_activity_freq_sy1_2 >60 & avg_activity_freq_sy1_2 <= 80 ~ "daily",
avg_activity_freq_sy1_2 >80 & avg_activity_freq_sy1_2<= 100 ~ "multi_daily"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy1_2 = as.numeric(as.character(avg_activity_intensity_sy1_2))) %>%
mutate(avg_activity_intensity_sy1_2_splits = case_when(
avg_activity_intensity_sy1_2 <= 33.3 ~ "low",
avg_activity_intensity_sy1_2 >33.3 & avg_activity_intensity_sy1_2<= 66.7 ~ "moderate",
avg_activity_intensity_sy1_2 >66.7 & avg_activity_intensity_sy1_2<= 100 ~ "high",
))
#SY3 + intensity and freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy3 = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_activity_freq_sy3_splits = case_when(
avg_activity_freq_sy3 <= 20 ~ "rarely",
avg_activity_freq_sy3 >20 & avg_activity_freq_sy3<= 40 ~ "monthly",
avg_activity_freq_sy3 >40 & avg_activity_freq_sy3<= 60 ~ "weekly",
avg_activity_freq_sy3 >60 & avg_activity_freq_sy3 <= 80 ~ "daily",
avg_activity_freq_sy3 >80 & avg_activity_freq_sy3<= 100 ~ "multi_daily",
is.na(avg_activity_freq_sy3) ~ "no_records_for_this_time_period"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy3 = as.numeric(as.character(avg_activity_intensity_sy3))) %>%
mutate(avg_activity_intensity_sy3_splits = case_when(
avg_activity_intensity_sy3 <= 20 ~ "slow_walks",
avg_activity_intensity_sy3 >20 & avg_activity_intensity_sy3<= 40 ~ "average_walks",
avg_activity_intensity_sy3 >40 & avg_activity_intensity_sy3<= 60 ~ "brisk_walks",
avg_activity_intensity_sy3 >60 & avg_activity_intensity_sy3 <= 80 ~ "jogs",
avg_activity_intensity_sy3 >80 & avg_activity_intensity_sy3<= 100 ~ "runs",
is.na(avg_activity_intensity_sy3) ~ "no_records_for_this_time_period"
))
#5y prior endpoint  freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_frequency_5y_prior_endpoint = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_frequency_5y_prior_endpoint_splits = case_when(
avg_frequency_5y_prior_endpoint <= 20 ~ "rarely",
avg_frequency_5y_prior_endpoint >20 & avg_frequency_5y_prior_endpoint<= 40 ~ "monthly",
avg_frequency_5y_prior_endpoint >40 & avg_frequency_5y_prior_endpoint<= 60 ~ "weekly",
avg_frequency_5y_prior_endpoint >60 & avg_frequency_5y_prior_endpoint <= 80 ~ "daily",
avg_frequency_5y_prior_endpoint >80 &avg_frequency_5y_prior_endpoint<= 100 ~ "multi_daily",
is.na(avg_frequency_5y_prior_endpoint) ~"no_records_for_this_time_period"
))
#5y prior endpoint intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_intensity_5y_prior_endpoint = as.numeric(as.character(avg_intensity_5y_prior_endpoint))) %>%
mutate(avg_intensity_5y_prior_endpoint_splits = case_when(
avg_intensity_5y_prior_endpoint <= 20 ~ "slow_walks",
avg_intensity_5y_prior_endpoint >20 & avg_intensity_5y_prior_endpoint<= 40 ~ "average_walks",
avg_intensity_5y_prior_endpoint >40 & avg_intensity_5y_prior_endpoint<= 60 ~ "brisk_walks",
avg_intensity_5y_prior_endpoint >60 & avg_intensity_5y_prior_endpoint <= 80 ~ "jogs",
avg_intensity_5y_prior_endpoint >80 & avg_intensity_5y_prior_endpoint<= 100 ~ "runs",
is.na(avg_intensity_5y_prior_endpoint) ~"no_records_for_this_time_period"
))
#recode into larger groupings e.g grouping together rarely + monthly for frequency
#freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy3_splits_grouped = case_when(
avg_activity_freq_sy3_splits == "monthly" ~ "rarely",
avg_activity_freq_sy3_splits == "multi_daily"~"daily_or_more" ,
avg_activity_freq_sy3_splits == "daily" ~"daily_or_more" ,
avg_activity_freq_sy3_splits == "weekly" ~"weekly" ,
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
))
#intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <-dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy3_splits_grouped = case_when(
avg_activity_intensity_sy3_splits == "jogs" ~ "high_intensity",
avg_activity_intensity_sy3_splits == "runs" ~"high_intensity" ,
avg_activity_intensity_sy3_splits == "brisk_walks" ~"moderate_intensity",
avg_activity_intensity_sy3_splits =="average_walks" ~ "low_intensity",
avg_activity_intensity_sy3_splits =="slow_walks" ~ "low_intensity"
))
#5y prior freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_frequency_5y_prior_endpoint_splits_grouped = case_when(
avg_frequency_5y_prior_endpoint_splits == "monthly" ~ "rarely",
avg_frequency_5y_prior_endpoint_splits == "multi_daily"~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "daily" ~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "weekly" ~"weekly" ,
avg_frequency_5y_prior_endpoint_splits == "rarely" ~"rarely" ,
avg_frequency_5y_prior_endpoint_splits == "no_records_for_this_time_period" ~"no_records_for_this_time_period"
))
#5y prior intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_intensity_5y_prior_endpoint_splits_grouped = case_when(
avg_intensity_5y_prior_endpoint_splits == "jogs" ~ "high_intensity",
avg_intensity_5y_prior_endpoint_splits == "runs" ~"high_intensity" ,
avg_intensity_5y_prior_endpoint_splits == "brisk_walks" ~"moderate_intensity",
avg_intensity_5y_prior_endpoint_splits =="average_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="slow_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="no_records_for_this_time_period" ~ "no_records_for_this_time_period"
))
activity_overview <- activity_overview %>%
mutate(activity_level_ordinal = case_when(
activity_level == "None" ~ 0,
activity_level == "Little" ~ 1,
activity_level == "Moderate" ~ 2,
activity_level == "Very active" ~ 3,
activity_level == "" ~ NA)
)
#only 3 NAs
# function to calculate mode as not built into summarise funct
get_mode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]
}
early_life_activity_overview <- activity_overview %>%
filter(year_in_study < 3) %>%
group_by(subject_id) %>%
summarise(
early_activity_mode = get_mode(activity_level_ordinal),
early_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
early_activity_median = median(activity_level_ordinal, na.rm = TRUE),
early_activity_min = min(activity_level_ordinal, na.rm = TRUE),
early_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
rest_life_activity_overview <- activity_overview %>%
filter(year_in_study > 2) %>%
group_by(subject_id) %>%
summarise(
rest_activity_mode = get_mode(activity_level_ordinal),
rest_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
rest_activity_median = median(activity_level_ordinal, na.rm = TRUE),
rest_activity_min = min(activity_level_ordinal, na.rm = TRUE),
rest_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
whole_life_activity_overview <- activity_overview %>%
group_by(subject_id) %>%
summarise(
whole_activity_mode = get_mode(activity_level_ordinal),
whole_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
whole_activity_median = median(activity_level_ordinal, na.rm = TRUE),
whole_activity_min = min(activity_level_ordinal, na.rm = TRUE),
whole_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
early_rest_whole_activity_overview <- whole_life_activity_overview %>% left_join(early_life_activity_overview,by="subject_id") %>% left_join(rest_life_activity_overview, by="subject_id")
#replace NAs with "records_not_available"
early_rest_whole_activity_overview <- early_rest_whole_activity_overview %>%
mutate(across(2:16, ~ case_when(
is.na(.) ~ "no_activity_records_for_this_time_period",
TRUE ~ as.character(.)
)))
=======
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(median_weight_5y_prior_endpoint_kg = if_else(age_at_final_date < 1.5, NA_real_, median_weight_5y_prior_endpoint_kg))
#avg height to cm
#avg height to cm
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(avg_height_5y_prior_endpoint_cm = avg_height_5y_prior_endpoint * 2.54)
#### remove height values for dogs that have their age at final date as <18m (ie. non adult heights) = 6 dogs
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
mutate(avg_height_5y_prior_endpoint_cm = if_else(age_at_final_date < 1.5, NA_real_, avg_height_5y_prior_endpoint_cm))
#median
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight3 %>%
mutate(median_height_5y_prior_endpoint_cm = median_height_5y_prior_endpoint * 2.54)
#### remove height values for dogs that have their age at final date as <18m (ie. non adult heights) = 6 dogs
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
mutate(median_height_5y_prior_endpoint_cm = if_else(age_at_final_date < 1.5, NA_real_, median_height_5y_prior_endpoint_cm))
#keep only distinct rows
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
distinct(subject_id,.keep_all = TRUE)
#for some reason, losing records of ~23 dogs with this distinct function - take weight data and re-add to last 3044 df
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_abr <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4 %>%
dplyr::select(subject_id,276:286)
#rejoin back
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3 %>% left_join(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_abr,by="subject_id")
write.csv(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_lymphoma_variables_dataset_interim.csv")
#activity data from study y 1 and 2
activity_sy1_2 <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_details_through_SY2.csv")
#check # dogs in it
act_1_2 <- unique(activity_sy1_2$subject_id)
#activity data from study y 3 +
activity_sy3_beyond <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_details_SY3_beyond.csv")
act_3_plus<- unique(activity_sy3_beyond$subject_id)
#activity overview dataset
activity_overview<- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/activity_overview.csv")
act_over<-unique(activity_overview$subject_id)
#create a new column of total activity to include both lead walk and off lead activity
activity_sy1_2 <- activity_sy1_2 %>%
mutate(total_activity_duration = paste(walk_duration,aerobic_duration,  sep = "_")) %>%
mutate(total_activity_freq= paste(walk_frequency,aerobic_frequency,sep="_")) %>%
mutate(total_activity_intensity =paste(walk_pace,aerobic_pace,sep="_"))
#check all dogs have sy1_2 recorded - they do
unique_actsy1_2 <- unique(activity_sy1_2$subject_id)
#duration recoding
less_than_30min <- c("_10-30 minutes", "10-30 minutes_","Less than 10 minutes_","Less than 10 minutes_Less than 10 minutes","_Less than 10 minutes","10-30 minutes_Less than 10 minutes","_")
#
between_31_60min <-c("_30-60 minutes","10-30 minutes_30-60 minutes","30-60 minutes_","Less than 10 minutes_10-30 minutes","10-30 minutes_10-30 minutes","30-60 minutes_Less than 10 minutes","Less than 10 minutes_30-60 minutes","30-60 minutes_10-30 minutes")
#
between_61_90min<- c("Greater than 60 minutes_","_Greater than 60 minute","10-30 minutes_Greater than 60 minutes","Greater than 60 minutes_10-30 minutes","_Greater than 60 minutes","Greater than 60 minutes_Less than 10 minutes","Greater than 60 minutes_Less than 10 minutes","Less than 10 minutes_Greater than 60 minutes")
#
between_91_120min <- c("Greater than 60 minutes_30-60 minutes","30-60 minutes_Greater than 60 minutes","30-60 minutes_30-60 minutes")
#
more_than_120min<- c("Greater than 60 minutes_Greater than 60 minutes")
all_groups <- c(less_than_30min,between_31_60min,between_61_90min,
between_91_120min,more_than_120min)
# Find any cateogories that are not in any group
duration <- setdiff(activity_sy1_2$total_activity_duration, all_groups)
# Display unclassified clinical signs
print(duration)
#recode in df
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_duration_regroup = case_when(
total_activity_duration %in% less_than_30min ~ "less_than_30min",
total_activity_duration %in% between_31_60min ~ "between_31_60min",
total_activity_duration %in% between_61_90min ~ "between_61_90min",
total_activity_duration %in% between_91_120min ~ "between_91_120min",
total_activity_duration %in% more_than_120min ~ "more_than_120min",
TRUE ~ "no_duration_recorded" # For values not in any group
)
)
#frequency recoding
never <- c("Never_","Never_Less than once/month")
less_than_weekly <- c("Less than once/month_","Less than once/month_Less than once/month", "Less than once/month_Less than once/week","Less than once/week_Less than once/month","Never_Less than once/week","Less than once/week_",
"Less than once/week_Less than once/week")
min_weekly<-c("Once or twice/week_Once or twice/week","Once or twice/week_","Never_Once or twice/week","Once or twice/week_Less than once/month",
"Once or twice/week_Less than once/week","Less than once/week_Once or twice/week","Less than once/month_Once or twice/week")
daily<-c("Once/day_","Less than once/week_Once/day","Never_Once/day", "Once or twice/week_Once/day","Once/day_Once or twice/week","Once/day_Less than once/week",
"Once/day_Less than once/month","Once/day_Once or twice/week",
"Once/day_Less than once/week", "Once/day_Less than once/month",
"Once or twice/week_Once/day","Less than once/month_Once/day"
)
multi_daily <-c("Once/day_Once/day","Once/day_More than once a day","More than once a day_","Once or twice/week_More than once a day","Less than once/month_More than once a day","More than once a day_Once/day","Never_More than once a day","More than once a day_Less than once/month","More than once a day_Once or twice/week","Less than once/week_More than once a day","More than once a day_More than once a day",
"More than once a day_Less than once/week")
all_groups_freq <- c(never,less_than_weekly,min_weekly,daily,multi_daily)
freq <- setdiff(activity_sy1_2$total_activity_freq, all_groups_freq)
# Display unclassified freq
print(freq)
#recode in df
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_freq_regroup = case_when(
total_activity_freq %in% never ~ "never",
total_activity_freq %in% less_than_weekly ~ "less_than_weekly",
total_activity_freq %in% min_weekly ~ "min_weekly",
total_activity_freq %in% daily ~ "daily",
total_activity_freq %in% multi_daily ~ "multi_daily",
TRUE ~ "no_freq_recorded" # For values not in any group
)
)
#create recoded freq column
#intensity recoding
low_only <-c("_Bursts of exercise less than 30% of the time","Slow_","Slow_Bursts of exercise less than 30% of the time"
)
moderate <-c("Average_","_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Brisk_","Brisk_Bursts of exercise less than 30% of the time","Average_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Jog_","Average_Bursts of exercise less than 30% of the time","Jog_Bursts of exercise less than 30% of the time","Brisk_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Slow_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)")
high <-c(" _Engages in strenuous exercise most of the time (greater than 60%)","Run_","Average_Engages in strenuous exercise most of the time (greater than 60%)","Brisk_Engages in strenuous exercise most of the time (greater than 60%)","_Engages in strenuous exercise most of the time (greater than 60%)","Jog_Engages in strenuous exercise most of the time (greater than 60%)","Run_Engages in strenuous exercise most of the time (greater than 60%)","Run_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)", "Slow_Engages in strenuous exercise most of the time (greater than 60%)",
"Jog_Engages in moderate exercise (greater than 30% of the time but less than 60% of the time)","Run_Bursts of exercise less than 30% of the time")
all_groups_int <- c(low_only,moderate,high)
int <- setdiff(activity_sy1_2$total_activity_intensity, all_groups_int)
print(int)
#create recoded intensity column
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_intensity_regroup = case_when(
total_activity_intensity %in% low_only ~ "low_int",
total_activity_intensity %in% moderate ~ "mod_int",
total_activity_intensity %in% high ~ "high_int",
TRUE ~ "no_int_recorded" # For values not in any group
)
)
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_duration_regroup_num = case_when(
total_activity_duration %in% less_than_30min ~ "20",
total_activity_duration %in% between_31_60min ~ "40",
total_activity_duration %in% between_61_90min ~ "60",
total_activity_duration %in% between_91_120min ~ "80",
total_activity_duration %in% more_than_120min ~ "100",
TRUE ~ "0" # For values not in any group
)
)
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_freq_regroup_num = case_when(
total_activity_freq %in% never ~ "20",
total_activity_freq %in% less_than_weekly ~ "40",
total_activity_freq %in% min_weekly ~ "60",
total_activity_freq %in% daily ~ "80",
total_activity_freq %in% multi_daily ~ "100",
TRUE ~ "0" # For values not in any group
)
)
#create recoded intensity column
activity_sy1_2 <- activity_sy1_2  %>%
mutate(
total_activity_intensity_regroup_num = case_when(
total_activity_intensity %in% low_only ~ "33.3",
total_activity_intensity %in% moderate ~ "66.7",
total_activity_intensity %in% high ~ "100",
TRUE ~ "0" # For values not in any group
)
)
#create column for USDA activity <30min or >30 min
activity_sy1_2 <- activity_sy1_2 %>%
mutate(USDA_30min = case_when (
total_activity_duration_regroup %in% c("less_than_30min") ~ "below_USDA",  total_activity_duration_regroup %in% c("between_31_60min", "between_61_90min","between_91_120min","more_than_120min") ~ "more_than_USDA",
TRUE ~ NA ))
#create column for UKKC recommendaiton <2h but cannot do this one so >1h
activity_sy1_2 <- activity_sy1_2 %>%
mutate(activity_1h_min = case_when (
total_activity_duration_regroup %in% c("less_than_30min","between_31_60min") ~ "below_1h",  total_activity_duration_regroup %in% c("between_61_90min","between_91_120min","more_than_120min") ~ "more_than_1h",
TRUE ~ NA ))
activity_sy1_2 <- activity_sy1_2 %>%
mutate(activity_KC_2h_min = case_when (
total_activity_duration_regroup %in% c("less_than_30min","between_31_60min","between_61_90min","between_91_120min") ~ "below_KC",  total_activity_duration_regroup %in% c("more_than_120min") ~ "more_than_KC",
TRUE ~ NA ))
#convert to numeric for score systems
activity_sy1_2 <- activity_sy1_2 %>%
mutate(across(24:26, as.numeric))
totals_avg <- activity_sy1_2 %>%
group_by(subject_id) %>%
summarise(
avg_activity_duration = (mean(sum(total_activity_duration_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100,
avg_activity_intensity = (mean(sum(total_activity_intensity_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100,
avg_activity_freq = (mean(sum(total_activity_freq_regroup_num, na.rm = TRUE)) /
(n() * 100)) * 100
)
# Join the average values back to the original dataset
activity_sy1_2 <- activity_sy1_2 %>%
left_join(totals_avg, by = "subject_id")
#check unique IDs in SY3+ to check all dogs have records - they do not, approx 400 dogs missing records so need to account for this later on when adding back to 3044 dog df
unique_sy3 <- unique(activity_sy3_beyond$subject_id)
activity_sy3_beyond <- activity_sy3_beyond %>%
mutate(pace_num = case_when(
pace == "Slow walk" ~ 20,
pace == "Average walk" ~ 40,
pace == "Brisk walk" ~ 60,
pace == "Jog" ~ 80,
pace == "Run" ~ 100,
pace == "" ~ 0  # empty cells replace with 0 for calculation purposes
))
activity_sy3_beyond <- activity_sy3_beyond %>%
mutate(frequency_num = case_when(
frequency == "Rarely" ~ 20,
frequency == "Monthly" ~ 40,
frequency == "Weekly" ~ 60,
frequency == "Daily" ~ 80,
frequency == "More than daily" ~ 100,
frequency == "" ~ 0  # empty cells replace with 0 for calculation purposes
))
totals_y3 <- activity_sy3_beyond %>%
group_by(subject_id) %>%
summarise(
# avg_activity_duration = (mean(duration_num, na.rm = TRUE)/
#                          (n() * 100)) * 100,
avg_activity_intensity = (mean(pace_num, na.rm = TRUE)/
(n() * 100)) * 100,
avg_activity_freq=(mean(frequency_num,na.rm=TRUE)/
(n() * 100)) * 100# Replace with your column
)
# Join the totals back to the original dataset
activity_sy3_beyond <- activity_sy3_beyond %>%
left_join(totals_y3, by = "subject_id")
activity_overview <- activity_overview %>%
mutate(activity_level_num = case_when(
activity_level == "None" ~ 25,
activity_level == "Little" ~ 50,
activity_level == "Moderate" ~ 75,
activity_level == "Very active" ~ 100,
activity_level == "" ~ 0)
)
totals <- activity_overview %>%
group_by(subject_id) %>%
summarise(mean_activity_level=(mean(activity_level_num, na.rm=TRUE)/(n() * 100)) * 100)
# Join the totals back to the original dataset
activity_overview <- activity_overview %>%
left_join(totals, by = "subject_id")
activity_sy1_2_abr_3 <- activity_sy1_2 %>%
dplyr::select(c(subject_id,year_in_study, USDA_30min,activity_1h_min,activity_KC_2h_min,avg_activity_duration,avg_activity_intensity,avg_activity_freq))
activity_sy3_beyond_abr_3 <- activity_sy3_beyond %>%
dplyr::select(c(subject_id,year_in_study,
#frequency,pace,duration,frequency_num,pace_num,duration_num,<- not keeping as multi rows same year
avg_activity_freq,avg_activity_intensity))
activity_overview_abr_3 <- activity_overview %>%
dplyr::select(c(subject_id,year_in_study,mean_activity_level))
activity_sy1_2_abr_3 <- activity_sy1_2_abr_3 %>%
distinct(subject_id, .keep_all = TRUE)  %>%
# mutate(study_year = "y1_2")%>%
rename_with(~ paste0(., "_sy1_2"), .cols = 3:8)%>%
dplyr::select(-c(year_in_study))
#sy 3+
activity_sy3_beyond_abr_3 <- activity_sy3_beyond_abr_3 %>%
distinct(subject_id,  .keep_all = TRUE)  %>%
#  mutate(study_year = "y3_on")%>%
rename_with(~ paste0(., "_sy3"), .cols = 3:4)%>%
dplyr::select(-c(year_in_study))
#overview
activity_overview_abr_3 <- activity_overview_abr_3 %>%
distinct(subject_id, .keep_all = TRUE)  %>%
# mutate(study_year="all_years") %>%
rename_with(~ paste0(., "_overview"), .cols = 3:3)%>%
dplyr::select(-c(year_in_study))
activity_all_3 <- activity_overview_abr_3 %>%
left_join(activity_sy1_2_abr_3, by= "subject_id")
activity_all_3_3 <- activity_all_3 %>%
left_join(activity_sy3_beyond_abr_3,by="subject_id")
#NAs recode as "no_records_available" for the SY3
activity_all_3_3 <- activity_all_3_3 %>%
mutate(across(9:10, ~case_when(
is.na(.) ~ "no_records_for_this_time_period",
TRUE ~ as.character(.)
)))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique %>%
dplyr::select(-c(year_in_study.x,year_in_study.y,record_date.y))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_unique %>%
left_join(activity_all_3_3, by="subject_id")
#keep SY0-2 and SY3 beyond same cols only
activity_sy1_2_same <- activity_sy1_2 %>%
dplyr::select(c(subject_id,year_in_study,total_activity_intensity_regroup_num,total_activity_freq_regroup_num))
#rename cols to match SY3
activity_sy1_2_same <- activity_sy1_2_same %>%
rename(pace_num = total_activity_intensity_regroup_num, frequency_num = total_activity_freq_regroup_num)
activity_sy3_same<- activity_sy3_beyond %>%
dplyr::select(c(subject_id,year_in_study,pace_num,frequency_num))
activity_all_y_all_rows <- rbind(activity_sy1_2_same,activity_sy3_same)
#join to cohort for 5y backwards calculations
#abridge cohort to only keep relevant columns then join back to ~200 col df after
cohort_abr <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity %>%
dplyr::select(c(subject_id,end_date2,lymphoma,year_in_study_diagnosis_or_final_record_year))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows <- activity_all_y_all_rows %>%
left_join(cohort_abr,by="subject_id")
#many to many match from step above resolved by only keeping unique row for each patient
#only singhle unique row per patient]
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows[!duplicated(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows), ]
#make sure year is in numeric
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2$year_in_study_diagnosis_or_final_record_year  <- as.numeric(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2$year_in_study_diagnosis_or_final_record_year )
cohort_5y_prior <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_all_rows_2 %>%
group_by(subject_id) %>%
filter(year_in_study >= (year_in_study_diagnosis_or_final_record_year - 5)) %>%
summarise(
avg_intensity_5y_prior_endpoint = mean(pace_num, na.rm = TRUE),
avg_frequency_5y_prior_endpoint = mean(frequency_num, na.rm = TRUE),
.groups = "drop"
)
#combine all the activity data back again
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity %>%
left_join(cohort_5y_prior, by="subject_id")
#for any dogs with NAs recode "reocrds_not_available"
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(across(287:288, ~case_when(
is.na(.) ~ "no_records_for_this_time_period",
TRUE ~ as.character(.)
)))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_duration_sy1_2 = as.numeric(as.character(avg_activity_duration_sy1_2))) %>%
mutate(avg_activity_duration_sy1_2_splits = case_when(
avg_activity_duration_sy1_2 <= 20 ~ "less_than_30min",
avg_activity_duration_sy1_2 >20 & avg_activity_duration_sy1_2 <= 40 ~ "between_30_60_min",
avg_activity_duration_sy1_2 >40 & avg_activity_duration_sy1_2<= 60 ~ "between_60_90_min",
avg_activity_duration_sy1_2 >60 & avg_activity_duration_sy1_2 <= 80 ~ "between_90_120_min",
avg_activity_duration_sy1_2 >80 & avg_activity_duration_sy1_2 <= 100 ~ "more_than_120_min"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy1_2 = as.numeric(as.character(avg_activity_freq_sy1_2))) %>%
mutate(avg_activity_freq_sy1_2_splits = case_when(
avg_activity_freq_sy1_2 <= 20 ~ "never",
avg_activity_freq_sy1_2 >20 & avg_activity_freq_sy1_2<= 40 ~ "less_than_weekly",
avg_activity_freq_sy1_2 >40 & avg_activity_freq_sy1_2<= 60 ~ "min_weekly",
avg_activity_freq_sy1_2 >60 & avg_activity_freq_sy1_2 <= 80 ~ "daily",
avg_activity_freq_sy1_2 >80 & avg_activity_freq_sy1_2<= 100 ~ "multi_daily"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy1_2 = as.numeric(as.character(avg_activity_intensity_sy1_2))) %>%
mutate(avg_activity_intensity_sy1_2_splits = case_when(
avg_activity_intensity_sy1_2 <= 33.3 ~ "low",
avg_activity_intensity_sy1_2 >33.3 & avg_activity_intensity_sy1_2<= 66.7 ~ "moderate",
avg_activity_intensity_sy1_2 >66.7 & avg_activity_intensity_sy1_2<= 100 ~ "high",
))
#SY3 + intensity and freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy3 = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_activity_freq_sy3_splits = case_when(
avg_activity_freq_sy3 <= 20 ~ "rarely",
avg_activity_freq_sy3 >20 & avg_activity_freq_sy3<= 40 ~ "monthly",
avg_activity_freq_sy3 >40 & avg_activity_freq_sy3<= 60 ~ "weekly",
avg_activity_freq_sy3 >60 & avg_activity_freq_sy3 <= 80 ~ "daily",
avg_activity_freq_sy3 >80 & avg_activity_freq_sy3<= 100 ~ "multi_daily",
is.na(avg_activity_freq_sy3) ~ "no_records_for_this_time_period"
))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy3 = as.numeric(as.character(avg_activity_intensity_sy3))) %>%
mutate(avg_activity_intensity_sy3_splits = case_when(
avg_activity_intensity_sy3 <= 20 ~ "slow_walks",
avg_activity_intensity_sy3 >20 & avg_activity_intensity_sy3<= 40 ~ "average_walks",
avg_activity_intensity_sy3 >40 & avg_activity_intensity_sy3<= 60 ~ "brisk_walks",
avg_activity_intensity_sy3 >60 & avg_activity_intensity_sy3 <= 80 ~ "jogs",
avg_activity_intensity_sy3 >80 & avg_activity_intensity_sy3<= 100 ~ "runs",
is.na(avg_activity_intensity_sy3) ~ "no_records_for_this_time_period"
))
#5y prior endpoint  freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_frequency_5y_prior_endpoint = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_frequency_5y_prior_endpoint_splits = case_when(
avg_frequency_5y_prior_endpoint <= 20 ~ "rarely",
avg_frequency_5y_prior_endpoint >20 & avg_frequency_5y_prior_endpoint<= 40 ~ "monthly",
avg_frequency_5y_prior_endpoint >40 & avg_frequency_5y_prior_endpoint<= 60 ~ "weekly",
avg_frequency_5y_prior_endpoint >60 & avg_frequency_5y_prior_endpoint <= 80 ~ "daily",
avg_frequency_5y_prior_endpoint >80 &avg_frequency_5y_prior_endpoint<= 100 ~ "multi_daily",
is.na(avg_frequency_5y_prior_endpoint) ~"no_records_for_this_time_period"
))
#5y prior endpoint intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_intensity_5y_prior_endpoint = as.numeric(as.character(avg_intensity_5y_prior_endpoint))) %>%
mutate(avg_intensity_5y_prior_endpoint_splits = case_when(
avg_intensity_5y_prior_endpoint <= 20 ~ "slow_walks",
avg_intensity_5y_prior_endpoint >20 & avg_intensity_5y_prior_endpoint<= 40 ~ "average_walks",
avg_intensity_5y_prior_endpoint >40 & avg_intensity_5y_prior_endpoint<= 60 ~ "brisk_walks",
avg_intensity_5y_prior_endpoint >60 & avg_intensity_5y_prior_endpoint <= 80 ~ "jogs",
avg_intensity_5y_prior_endpoint >80 & avg_intensity_5y_prior_endpoint<= 100 ~ "runs",
is.na(avg_intensity_5y_prior_endpoint) ~"no_records_for_this_time_period"
))
#recode into larger groupings e.g grouping together rarely + monthly for frequency
#freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_freq_sy3_splits_grouped = case_when(
avg_activity_freq_sy3_splits == "monthly" ~ "rarely",
avg_activity_freq_sy3_splits == "multi_daily"~"daily_or_more" ,
avg_activity_freq_sy3_splits == "daily" ~"daily_or_more" ,
avg_activity_freq_sy3_splits == "weekly" ~"weekly" ,
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
))
#intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <-dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_activity_intensity_sy3_splits_grouped = case_when(
avg_activity_intensity_sy3_splits == "jogs" ~ "high_intensity",
avg_activity_intensity_sy3_splits == "runs" ~"high_intensity" ,
avg_activity_intensity_sy3_splits == "brisk_walks" ~"moderate_intensity",
avg_activity_intensity_sy3_splits =="average_walks" ~ "low_intensity",
avg_activity_intensity_sy3_splits =="slow_walks" ~ "low_intensity"
))
#5y prior freq
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_frequency_5y_prior_endpoint_splits_grouped = case_when(
avg_frequency_5y_prior_endpoint_splits == "monthly" ~ "rarely",
avg_frequency_5y_prior_endpoint_splits == "multi_daily"~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "daily" ~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "weekly" ~"weekly" ,
avg_frequency_5y_prior_endpoint_splits == "rarely" ~"rarely" ,
avg_frequency_5y_prior_endpoint_splits == "no_records_for_this_time_period" ~"no_records_for_this_time_period"
))
#5y prior intensity
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity<- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
mutate(avg_intensity_5y_prior_endpoint_splits_grouped = case_when(
avg_intensity_5y_prior_endpoint_splits == "jogs" ~ "high_intensity",
avg_intensity_5y_prior_endpoint_splits == "runs" ~"high_intensity" ,
avg_intensity_5y_prior_endpoint_splits == "brisk_walks" ~"moderate_intensity",
avg_intensity_5y_prior_endpoint_splits =="average_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="slow_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="no_records_for_this_time_period" ~ "no_records_for_this_time_period"
))
activity_overview <- activity_overview %>%
mutate(activity_level_ordinal = case_when(
activity_level == "None" ~ 0,
activity_level == "Little" ~ 1,
activity_level == "Moderate" ~ 2,
activity_level == "Very active" ~ 3,
activity_level == "" ~ NA)
)
#only 3 NAs
# function to calculate mode as not built into summarise funct
get_mode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]
}
early_life_activity_overview <- activity_overview %>%
filter(year_in_study < 3) %>%
group_by(subject_id) %>%
summarise(
early_activity_mode = get_mode(activity_level_ordinal),
early_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
early_activity_median = median(activity_level_ordinal, na.rm = TRUE),
early_activity_min = min(activity_level_ordinal, na.rm = TRUE),
early_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
rest_life_activity_overview <- activity_overview %>%
filter(year_in_study > 2) %>%
group_by(subject_id) %>%
summarise(
rest_activity_mode = get_mode(activity_level_ordinal),
rest_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
rest_activity_median = median(activity_level_ordinal, na.rm = TRUE),
rest_activity_min = min(activity_level_ordinal, na.rm = TRUE),
rest_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
whole_life_activity_overview <- activity_overview %>%
group_by(subject_id) %>%
summarise(
whole_activity_mode = get_mode(activity_level_ordinal),
whole_activity_mean = mean(activity_level_ordinal, na.rm = TRUE),
whole_activity_median = median(activity_level_ordinal, na.rm = TRUE),
whole_activity_min = min(activity_level_ordinal, na.rm = TRUE),
whole_activity_max = max(activity_level_ordinal, na.rm = TRUE),
.groups = "drop"
)
early_rest_whole_activity_overview <- whole_life_activity_overview %>% left_join(early_life_activity_overview,by="subject_id") %>% left_join(rest_life_activity_overview, by="subject_id")
#replace NAs with "records_not_available"
early_rest_whole_activity_overview <- early_rest_whole_activity_overview %>%
mutate(across(2:16, ~ case_when(
is.na(.) ~ "no_activity_records_for_this_time_period",
TRUE ~ as.character(.)
)))
>>>>>>> Stashed changes
#join onto main df
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>% left_join(early_rest_whole_activity_overview,by="subject_id")
colnames(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity)
#remove unnecessary columns:
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity2 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity %>%
dplyr::select(-c(record_date.x,X))
sum(is.na(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity2))
#check which columns have most NAs and decide how best to replace
na_summary <- colSums(is.na(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity2))
na_summary_df <- data.frame(
column = names(na_summary),
na_count = na_summary
) %>%
arrange(desc(na_count))
na_summary_df
View(na_summary_df)
colnames(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity2)
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity2 %>%
mutate(across(2:20, ~ replace(., is.na(.), "records_not_available")))
NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(across(35:263, ~ replace(., is.na(.), "records_not_available")))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(across(35:253, ~ replace(., is.na(.), "records_not_available")))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(across(266:313, ~ replace(., is.na(.), "records_not_available")))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <- dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(across(266:312, ~ replace(., is.na(.), "records_not_available")))
na_summary2 <- colSums(is.na(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3))
na_summary_df2 <- data.frame(
column = names(na_summary2),
na_count = na_summary2
) %>%
arrange(desc(na_count))
na_summary_df2
View(na_summary_df2)
#manually fix avg_weight_5y_prior_endpoint and MDI_quintile
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 <-
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(avg_weight_5y_prior_endpoint = replace(avg_weight_5y_prior_endpoint,
is.na(avg_weight_5y_prior_endpoint),
"records_not_available"))
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity_tidied <-
dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity3 %>%
mutate(MDI_quintile = replace(MDI_quintile,
is.na(MDI_quintile),
"records_not_available"))
write.csv(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity_tidied,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_lymphoma_variables_dataset.csv")
write.csv(dog_pop_deprivation_enviro_smoking_sleep_lifestyle_all_house_location_comorbs_meds_NSAID_steroid_neutering3_weight4_activity_endpoint_activity_tidied,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_lymphoma_variables_dataset.csv")
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
