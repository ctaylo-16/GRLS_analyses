sex== "M" ~ "Male",
sex_status == "Intact Female" ~ "Intact Female",
spayed_while_in_heat == "0" ~ "0",
spayed_while_in_heat == "1" ~"1"
))
#same as above account for unnetered and males
cohort_abr$heats_before_neutering <- as.numeric(cohort_abr$heats_before_neutering)
heats <- cohort_abr %>%
# Convert to numeric
filter(heats_before_neutering != 0) %>%
# Remove rows where the column is 0
filter(heats_before_neutering != "not_recorded")%>%
dplyr::select(heats_before_neutering)# Keep only this column
heats <- as.numeric(heats$heats_before_neutering)
# Function to calculate quartile or tercile dynamically
get_breaks <- function(x, probs) {
breaks <- quantile(x, probs = probs, na.rm = TRUE)
# If breaks are not unique, switch to tercile
if (length(unique(breaks)) < length(probs)) {
message("quartile not unique, switching to tercile.")
breaks <- quantile(x, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE)
}
return(breaks)
}
breaks <- get_breaks(heats, c(0, 0.25, 0.5, 0.75, 1))
# Assign labels dynamically
labels <- paste0("â‰¥", round(head(breaks, -1), 2), " - <", round(tail(breaks, -1), 2))
cohort_abr <- cohort_abr %>%
mutate(heats_before_neutering_tercile = case_when(
sex== "M" ~ "Male",
sex_status == "Intact Female" ~ "Intact Female",
heats_before_neutering == "0" ~ "0",
heats_before_neutering == "1" ~"1-<=2",
heats_before_neutering == "2" ~"1-<=2",
heats_before_neutering == "3" ~">2-<=4",
heats_before_neutering == "4" ~">2-<=4",
heats_before_neutering == "5" ~">4-12",
heats_before_neutering == "6" ~">4-12",
heats_before_neutering == "7" ~">4-12",
heats_before_neutering == "8" ~">4-12",
heats_before_neutering == "9" ~">4-12",
heats_before_neutering == "10" ~">4-12",
heats_before_neutering == "11" ~">4-12",
heats_before_neutering == "12" ~">4-12"
))
#create combined sex neuter variable
cohort_abr <- cohort_abr %>%
mutate(sex_neuter = paste(sex, neuter, sep = " "))
#ensure not_recorded is default not baseline
convert_and_relevel <- function(df) {
df <- df %>%
mutate(across(where(is.character), ~ factor(.))) %>%  # Convert all character columns to factors
mutate(across(where(is.factor), ~ fct_relevel(., "not_recorded", after = Inf)))  # Move "not_recorded" to last place
return(df)
}
# Apply to your dataset
cohort_abr <- convert_and_relevel(cohort_abr)
cohort_abr <- cohort_abr%>%
mutate(heats_before_neutering_tercile = factor(heats_before_neutering_tercile, levels = c("0", "1-<=2", ">2-<=4", ">4-12","Intact Female","Male","not_recorded")))
#neuter reason levels
cohort_abr <- cohort_abr%>%
mutate(neutered_reason = factor(neutered_reason, levels = c("Elective",  "Medical Reason", "Entire","Unknown")))
cohort_abr <- cohort_abr%>%
mutate(mode_purina_BCS_5y_prior_endpoint = factor(mode_purina_BCS_5y_prior_endpoint, levels = c("5", "3", "4", "6","7","8","9","not_recorded")))
#change BCS to be over underweight
cohort_abr <- cohort_abr %>%
mutate(mode_BCS_classify = case_when(
mode_purina_BCS_5y_prior_endpoint == "1" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "2" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "3" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "4" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "5" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "6" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "7" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "8" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "9" ~"overweight",
))
#set age levels
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years")))
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_bio = factor(age_at_final_date_bio, levels = c(">5-<8y","<5y",  ">8-<11y", ">11-<13y",">13y")))
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_GB = factor(age_at_final_date_GB, levels = c(">7-<9y","<5y", ">5-<7y",  ">9-<11y",">11-<13y",">13y")))
#manually assign height, weight, BCS factor levles and age at neuter and age at diagnosis
#height
cohort_abr <- cohort_abr%>%
mutate(avg_height_5y_prior_endpoint_quartiles = factor(avg_height_5y_prior_endpoint_quartiles, levels = c("49.80-<56.30cm", ">=56.30-<58.29cm", ">=58.29-<60.32cm", ">=60.32cm-67.73cm","not_recorded")))
#weight
cohort_abr <- cohort_abr%>%
mutate(avg_weight_5y_prior_endpoint_quartiles = factor(avg_weight_5y_prior_endpoint_quartiles, levels = c("12.47-<20.83kg", ">=20.83-<23.23kg", ">=23.23-26.98kg", ">=26.98-37.01","not_recorded")))
#recoding weight levels here so the <15kg dogs are now "not_recorded"
cohort_abr <- cohort_abr %>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = case_when(
avg_weight_5y_prior_endpoint_kg_biological == "<15kg" ~ "not_recorded",
TRUE ~ avg_weight_5y_prior_endpoint_kg_biological
))
cohort_abr <- cohort_abr%>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = factor(avg_weight_5y_prior_endpoint_kg_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median any records in 5y
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles, levels = c("10.5-<17.1kg", ">=17.1-<24.7kg", ">=24.7-30.6kg", ">=30.6-49.1kg","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median all 5 record years
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles, levels = c("10.5-<16.1kg", ">=16.1-<21.3kg", ">=21.3-28.8kg", ">=28.8-47.1kg","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
cohort_abr <- cohort_abr%>%
mutate(avg_purina_BCS_5y_prior_endpoint_quartiles = factor(avg_purina_BCS_5y_prior_endpoint_quartiles, levels = c("3.3-<5", ">=5-<5.28", ">=5.28-<5.86", ">=5.86 - 9","not_recorded")))
#neut age
cohort_abr <- cohort_abr%>%
mutate(age_at_neuter_years_quartiles = factor(age_at_neuter_years_quartiles, levels = c("0.15-<0.52y", ">=0.52-<0.83y", ">=0.83-2.44y", ">=2.44-9.59y","Entire","not_recorded")))
#diagnosis age
cohort_abr <- cohort_abr%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years","not_recorded")))
#breed tercile levels
cohort_abr <- cohort_abr%>%
mutate(num_breeding_before_neutering_terciles = factor(num_breeding_before_neutering_terciles, levels = c(">0-<3",">=3-<9",">=9-142","not_bred","not_recorded")))
#recode NSAID quartiles
cohort_abr <- cohort_abr%>%
mutate(NSAID_5y_quantiles = factor(NSAID_5y_quantiles, levels = c("no_NSAID_admin", "Q1(1)", "Q2(1-2)", "Q3(2-3)","Q4(3-11)","no_med_use_recorded")))
cohort_abr <- cohort_abr%>%
mutate(endo_5y_quantiles = factor(endo_5y_quantiles, levels = c("no_endo_admin", "Q1(1-2)", "Q2(2-3)", "Q3(3-4)","Q4(4-17)","no_med_use_recorded")))
cohort_abr <- cohort_abr%>%
mutate(ecto_5y_quantiles = factor(ecto_5y_quantiles, levels = c("no_ecto_admin", "Q1(1)", "Q2(1-2)", "Q3(2-4)","Q4(4-17)","no_med_use_recorded")))
###setting "no_medication_records_for_this_time_periodistered" as bottom factor level for drug variables as think it actually means drug use not recorded so doesnt make a good baseline
# Vector of the column names to modify
# Suppose you want to modify columns 3 to 17, for example
cols_to_modify <- 198:265  # replace with your actual column indices
for (i in cols_to_modify) {
current_levels <- levels(cohort_abr[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_abr[[i]] <- factor(cohort_abr[[i]], levels = new_levels)
}
}
#SY1 and 2
cohort_abr <- cohort_abr %>%
mutate(avg_activity_duration_sy1_2 = as.numeric(as.character(avg_activity_duration_sy1_2))) %>%
mutate(avg_activity_duration_sy1_2_splits = case_when(
avg_activity_duration_sy1_2 <= 20 ~ "less_than_30min",
avg_activity_duration_sy1_2 >20 & avg_activity_duration_sy1_2 <= 40 ~ "between_30_60_min",
avg_activity_duration_sy1_2 >40 & avg_activity_duration_sy1_2<= 60 ~ "between_60_90_min",
avg_activity_duration_sy1_2 >60 & avg_activity_duration_sy1_2 <= 80 ~ "between_90_120_min",
avg_activity_duration_sy1_2 >80 & avg_activity_duration_sy1_2 <= 100 ~ "more_than_120_min"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy1_2 = as.numeric(as.character(avg_activity_freq_sy1_2))) %>%
mutate(avg_activity_freq_sy1_2_splits = case_when(
avg_activity_freq_sy1_2 <= 20 ~ "never",
avg_activity_freq_sy1_2 >20 & avg_activity_freq_sy1_2<= 40 ~ "less_than_weekly",
avg_activity_freq_sy1_2 >40 & avg_activity_freq_sy1_2<= 60 ~ "min_weekly",
avg_activity_freq_sy1_2 >60 & avg_activity_freq_sy1_2 <= 80 ~ "daily",
avg_activity_freq_sy1_2 >80 & avg_activity_freq_sy1_2<= 100 ~ "multi_daily"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy1_2 = as.numeric(as.character(avg_activity_intensity_sy1_2))) %>%
mutate(avg_activity_intensity_sy1_2_splits = case_when(
avg_activity_intensity_sy1_2 <= 33.3 ~ "low",
avg_activity_intensity_sy1_2 >33.3 & avg_activity_intensity_sy1_2<= 66.7 ~ "moderate",
avg_activity_intensity_sy1_2 >66.7 & avg_activity_intensity_sy1_2<= 100 ~ "high",
))
#SY3 + intensity and freq
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy3 = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_activity_freq_sy3_splits = case_when(
avg_activity_freq_sy3 <= 20 ~ "rarely",
avg_activity_freq_sy3 >20 & avg_activity_freq_sy3<= 40 ~ "monthly",
avg_activity_freq_sy3 >40 & avg_activity_freq_sy3<= 60 ~ "weekly",
avg_activity_freq_sy3 >60 & avg_activity_freq_sy3 <= 80 ~ "daily",
avg_activity_freq_sy3 >80 & avg_activity_freq_sy3<= 100 ~ "multi_daily"
))
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy3 = as.numeric(as.character(avg_activity_intensity_sy3))) %>%
mutate(avg_activity_intensity_sy3_splits = case_when(
avg_activity_intensity_sy3 <= 20 ~ "slow_walks",
avg_activity_intensity_sy3 >20 & avg_activity_intensity_sy3<= 40 ~ "average_walks",
avg_activity_intensity_sy3 >40 & avg_activity_intensity_sy3<= 60 ~ "brisk_walks",
avg_activity_intensity_sy3 >60 & avg_activity_intensity_sy3 <= 80 ~ "jogs",
avg_activity_intensity_sy3 >80 & avg_activity_intensity_sy3<= 100 ~ "runs"
))
#5y prior endpoint  freq
cohort_abr <- cohort_abr %>%
mutate(avg_frequency_5y_prior_endpoint = as.numeric(as.character(avg_activity_freq_sy3))) %>%
mutate(avg_frequency_5y_prior_endpoint_splits = case_when(
avg_frequency_5y_prior_endpoint <= 20 ~ "rarely",
avg_frequency_5y_prior_endpoint >20 & avg_frequency_5y_prior_endpoint<= 40 ~ "monthly",
avg_frequency_5y_prior_endpoint >40 & avg_frequency_5y_prior_endpoint<= 60 ~ "weekly",
avg_frequency_5y_prior_endpoint >60 & avg_frequency_5y_prior_endpoint <= 80 ~ "daily",
avg_frequency_5y_prior_endpoint >80 &avg_frequency_5y_prior_endpoint<= 100 ~ "multi_daily"
))
#5y prior endpoint intensity
cohort_abr <- cohort_abr %>%
mutate(avg_intensity_5y_prior_endpoint = as.numeric(as.character(avg_intensity_5y_prior_endpoint))) %>%
mutate(avg_intensity_5y_prior_endpoint_splits = case_when(
avg_intensity_5y_prior_endpoint <= 20 ~ "slow_walks",
avg_intensity_5y_prior_endpoint >20 & avg_intensity_5y_prior_endpoint<= 40 ~ "average_walks",
avg_intensity_5y_prior_endpoint >40 & avg_intensity_5y_prior_endpoint<= 60 ~ "brisk_walks",
avg_intensity_5y_prior_endpoint >60 & avg_intensity_5y_prior_endpoint <= 80 ~ "jogs",
avg_intensity_5y_prior_endpoint >80 & avg_intensity_5y_prior_endpoint<= 100 ~ "runs"
))
#recode into larger groupings e.g grouping together rarely + monthly for frequency
#freq
cohort_abr <- cohort_abr %>%
mutate(avg_activity_freq_sy3_splits_grouped = case_when(
avg_activity_freq_sy3_splits == "monthly" ~ "rarely",
avg_activity_freq_sy3_splits == "multi_daily"~"daily_or_more" ,
avg_activity_freq_sy3_splits == "daily" ~"daily_or_more" ,
avg_activity_freq_sy3_splits == "weekly" ~"weekly" ,
avg_activity_freq_sy3_splits == "rarely" ~ "rarely",
))
#intensity
cohort_abr <- cohort_abr %>%
mutate(avg_activity_intensity_sy3_splits_grouped = case_when(
avg_activity_intensity_sy3_splits == "jogs" ~ "high_intensity",
avg_activity_intensity_sy3_splits == "runs" ~"high_intensity" ,
avg_activity_intensity_sy3_splits == "brisk_walks" ~"moderate_intensity",
avg_activity_intensity_sy3_splits =="average_walks" ~ "low_intensity",
avg_activity_intensity_sy3_splits =="slow_walks" ~ "low_intensity"
))
#5y prior freq
cohort_abr <- cohort_abr %>%
mutate(avg_frequency_5y_prior_endpoint_splits_grouped = case_when(
avg_frequency_5y_prior_endpoint_splits == "monthly" ~ "rarely",
avg_frequency_5y_prior_endpoint_splits == "multi_daily"~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "daily" ~"daily_or_more" ,
avg_frequency_5y_prior_endpoint_splits == "weekly" ~"weekly" ,
avg_frequency_5y_prior_endpoint_splits == "rarely" ~"rarely" ,
))
#5y prior intensity
cohort_abr <- cohort_abr %>%
mutate(avg_intensity_5y_prior_endpoint_splits_grouped = case_when(
avg_intensity_5y_prior_endpoint_splits == "jogs" ~ "high_intensity",
avg_intensity_5y_prior_endpoint_splits == "runs" ~"high_intensity" ,
avg_intensity_5y_prior_endpoint_splits == "brisk_walks" ~"moderate_intensity",
avg_intensity_5y_prior_endpoint_splits =="average_walks" ~ "low_intensity",
avg_intensity_5y_prior_endpoint_splits =="slow_walks" ~ "low_intensity"
))
#swap not_recorded for NA and exclude from univar this way
cohort_no_not_rec <- cohort_abr %>%
mutate(across(
where(~ is.character(.) | is.factor(.)),
~ factor(na_if(as.character(.), "not_recorded"))
))
dependent <- "had_HSA"
# All other variables as explanatory variables
explanatory = c(
#demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles",
"avg_purina_BCS_5y_prior_endpoint_quartiles","median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","NSAID_5y_quantiles","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever","ecto_5y_quantiles","endo_5y_quantiles"
)
# Create a univariable logistic regression table
univar_table <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,column = TRUE)
#column = TRUE does case and contorl counts for each variable category rather than rowise
univar_table2 <- cohort_abr %>%summary_factorlist(dependent, explanatory,
p=TRUE,  add_dependent_label=TRUE,na_include = TRUE,column=TRUE)
# View the results
print(univar_table)
write.csv(univar_table,"C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.csv")
#save as worddoc
# Install and load the required packages
library(officer)
library(flextable)
# Create a Word document
doc <- read_docx()
# Convert finalfit output to a flextable
results_flextable <- flextable(univar_table)
# Add the flextable to the Word document
doc <- doc %>%
body_add_flextable(results_flextable) %>%
body_add_par("Finalfit Regression Results", style = "heading 1")
# Save the Word document
print(doc, target = "C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/HSA_cross_table_case_control_output.docx")
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_auto.R")
cohort_abr$had_HSA <- as.factor(cohort_abr$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_abr2 <- cohort_abr %>%
dplyr::select(   #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles", "median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max"
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
source("C:/Users/ctaylor18/GitHub/HSA-VC-enviro-analyses/functions/univar_log_reg_auto.R")
cohort_abr$had_HSA <- as.factor(cohort_abr$had_HSA)
#leaving out the continuous variables as missing data causing issues
#"max_tumour_cm_value" "age_at_diagnosis_cont"
cohort_abr2 <- cohort_abr %>%
dplyr::select(   #demog
"age_at_final_date_GB","age_at_final_date_bio", "age_at_final_date_quartiles","age_at_neuter_years_quartiles","sex_neuter",
"sex", "neuter", "mismating_ever",
"neutered_reason", "neutered_ever_bred", "spayed_while_in_heat", "spayed_while_pregnant", "prevent_heat_ever",
"no_pregnancy_ever", "intact_sired_litters_natural_ever", "neutered_females_bred_with_count_ever",
"neutered_sired_litters_natural_ever", "heats_before_neutering", "heats_before_neutering_terciles",
"preg_pre_neuter",
"num_breeding_before_neutering_terciles", "ever_bred_from",
"avg_weight_5y_prior_endpoint_quartiles","avg_weight_5y_prior_endpoint_kg_biological", "avg_height_5y_prior_endpoint_quartiles", "median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles", "mode_purina_BCS_5y_prior_endpoint","median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological","median_weight_5y_prior_endpoint_kg_outliers_removed_biological",
"avg_purina_BCS_5y_prior_endpoint_quartiles", "mode_purina_BCS_5y_prior_endpoint", "mode_BCS_classify",
#lifestyle/activity
"main_lifestyle_category",
"main_lifestyle_category_mode_5yrs_prior", "USDA_30min_sy1_2", "activity_1h_min_sy1_2",
"activity_KC_2h_min_sy1_2", "avg_activity_duration_sy1_2_quartile",
"avg_activity_intensity_sy3_quartile", "avg_intensity_5y_prior_endpoint_quartile", "avg_frequency_5y_prior_endpoint_quartile", "avg_activity_duration_sy1_2_splits",
"avg_activity_freq_sy1_2_splits",
"avg_activity_freq_sy3_splits", "avg_activity_intensity_sy3_splits",  "avg_frequency_5y_prior_endpoint_splits",
"avg_activity_freq_sy3_splits_grouped", "avg_activity_intensity_sy3_splits_grouped",  "avg_frequency_5y_prior_endpoint_splits_grouped","avg_intensity_5y_prior_endpoint_splits","avg_intensity_5y_prior_endpoint_splits_grouped","whole_activity_mode","whole_activity_mean","whole_activity_median","whole_activity_min","whole_activity_max",
"early_activity_mode","early_activity_mean","early_activity_median","early_activity_min","early_activity_max","rest_activity_mode","rest_activity_mean","rest_activity_median","rest_activity_min","rest_activity_max","prior5y_activity_mode","prior5y_activity_mean","prior5y_activity_median","prior5y_activity_min","prior5y_activity_max",
#home/environmental
"MDI_quintile","owner_MDI_quintile","area_type_mode_5yrs_prior","house_type_mode_5yrs_prior",
"water_source_mode_5yrs_prior", "pipes_metal_any_mode_5yrs_prior", "pipes_plastic_any_mode_5yrs_prior",
"heating_fuel_primary_mode_5yrs_prior", "cooking_fuel_primary_mode_5yrs_prior", "heating_fuel_secondary_mode_5yrs_prior",
"cooking_fuel_secondary_mode_5yrs_prior", "region_mode_5y_prior","use_aerosol_study_years_early_life", "use_air_cleaner_study_years_early_life", "use_hepa_filter_study_years_early_life",
"use_moth_balls_study_years_early_life", "use_incense_or_candles_study_years_early_life", "smoke_exposure_study_years_early_life",  "use_aerosol_study_years_rest_of_life",
"use_air_cleaner_study_years_rest_of_life", "use_hepa_filter_study_years_rest_of_life", "use_moth_balls_study_years_rest_of_life",
"use_incense_or_candles_study_years_rest_of_life", "smoke_exposure_study_years_rest_of_life", "any_treated_weeds_study_years_rest_of_life",
"any_treated_insects_study_years_rest_of_life", "any_treated_fertilizer_study_years_rest_of_life","use_aerosol_study_years_whole_life",
"use_air_cleaner_study_years_whole_life", "use_hepa_filter_study_years_whole_life", "use_moth_balls_study_years_whole_life",
"use_incense_or_candles_study_years_whole_life", "smoke_exposure_study_years_whole_life", "any_treated_weeds_study_years_whole_life",
"any_treated_insects_study_years_whole_life", "any_treated_fertilizer_study_years_whole_life", "hours_of_smoke_early_life_total_dosage_terciles", "hours_of_smoke_rest_of_life_total_dosage_terciles",
"hours_of_smoke_whole_life_total_dosage_terciles", "in.the.garage_YN_study_years_early_life", "in.the.house_YN_study_years_early_life",
"outside_YN_study_years_early_life",
"in.the.garage_YN_study_years_rest_of_life", "in.the.house_YN_study_years_rest_of_life", "outside_YN_study_years_rest_of_life",
"in.the.house_YN_sum_rest_of_life_quartile",
"in.the.garage_YN_study_years_whole_life", "in.the.house_YN_study_years_whole_life", "outside_YN_study_years_whole_life",
"in.the.house_YN_sum_whole_life_quartile",
"majority_sleep_location_lifetime","sleep_location_mode_5yrs_prior",
"use_aerosol_exposed_5yrs_prior", "use_air_cleaner_exposed_5yrs_prior", "use_hepa_filter_exposed_5yrs_prior",
"use_moth_balls_exposed_5yrs_prior", "use_incense_or_candles_exposed_5yrs_prior", "smoke_exposure_exposed_5yrs_prior",
"any_treated_weeds_exposed_5yrs_prior", "any_treated_insects_exposed_5yrs_prior", "any_treated_fertilizer_exposed_5yrs_prior",
#comorbidities
"chronic_inflam_present_lifetime","number_comorbs_present_lifetime","chronic_inflam_present.x","chronic_inflam_present_5y","number_comorbs_present_5y","chronic_inflam_present_no_min_year","number_comorbs_present_no_min_year","intestinal_parasitism","tick_borne_parasitism","other_parasitism","all_parasitism","infectious","immune_mediated","cardiovascular","gastrointestinal","inflammatory_other","orthopaedic","chronic_inflammatory","lifelong_comorb_present.x","lifelong_orthopaedic","lifelong_immune_mediated","lifelong_cardiovascular","lifelong_gastrointestinal","lifelong_inflammatory_other","lifelong_chronic_inflammatory","number_lifelong_comorbs_present","malig_cancers_count","benign_cancers_count","all_cancers_count","all_cancers_YN","benign_cancers_YN","malig_cancers_YN","all_cancers_count_no_HSA","malig_cancers_count_no_HSA","malig_cancers_YN_no_HSA","all_cancers_YN_no_HSA","lymphoma_present","carcinoma_present","sarcoma_present","melanoma_present","adenocarcinoma_present","mast_cell_tumor_present",
#medications
"half_anti_microbials_lifetime", "half_dietary_supplements_lifetime",
"half_enteric_lifetime", "half_fluid_metabolites_lifetime", "half_hormones_and_related_lifetime", "half_immunologicals_lifetime",
"half_misc_lifetime", "half_neurological_lifetime", "half_anti_parasites_lifetime", "half_anti_septics_lifetime",
"half_cardio_respiratory_lifetime", "half_diuretics_lifetime", "half_anti_hist_lifetime",
"quartile_anti_inflam_lifetime", "quartile_anti_microbials_lifetime", "quartile_dietary_supplements_lifetime",
"quartile_hormones_and_related_lifetime",
"quartile_immunologicals_lifetime", "quartile_misc_lifetime", "quartile_neurological_lifetime",
"quartile_anti_parasites_lifetime",
"half_anti_inflam_5y_prior_endpoint", "half_anti_microbials_5y_prior_endpoint", "half_enteric_5y_prior_endpoint",
"half_immunologicals_5y_prior_endpoint", "half_misc_5y_prior_endpoint", "half_neurological_5y_prior_endpoint",
"half_anti_parasites_5y_prior_endpoint", "half_dietary_supplements_5y_prior_endpoint",
"half_anti_septics_5y_prior_endpoint", "half_hormones_and_related_5y_prior_endpoint",
"half_cardio_respiratory_5y_prior_endpoint", "half_fluid_metabolites_5y_prior_endpoint",
"half_diuretics_5y_prior_endpoint", "half_anti_hist_5y_prior_endpoint",
"quartile_anti_inflam_5y_prior_endpoint", "quartile_anti_microbials_5y_prior_endpoint",  "quartile_immunologicals_5y_prior_endpoint",
"quartile_misc_5y_prior_endpoint", "quartile_neurological_5y_prior_endpoint",
"quartile_anti_parasites_5y_prior_endpoint", "quartile_dietary_supplements_5y_prior_endpoint",
"quartile_hormones_and_related_5y_prior_endpoint", "NSAID_5y","NSAID_ever","NSAID_5y_quantiles","steroid_5y","steroid_ever","fenbendazole_5y","fenbendazole_ever", "ecto_5y_quantiles","endo_5y_quantiles","had_HSA")
cohort_abr2<- cohort_abr2%>%
mutate_all(~factor(ifelse(is.na(.), "not_recorded", as.character(.))))
cohort_abr2 <- cohort_abr2%>%
mutate(heats_before_neutering_terciles = factor(heats_before_neutering_terciles, levels = c("0", "1-<=2", ">2-<=4", ">4-12","Intact Female","Male","not_recorded")))
#neuter reason levels
cohort_abr2<- cohort_abr2%>%
mutate(neutered_reason = factor(neutered_reason, levels = c("Elective",  "Medical Reason", "Entire","Unknown","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(mode_purina_BCS_5y_prior_endpoint = factor(mode_purina_BCS_5y_prior_endpoint, levels = c("5", "3", "4", "6","7","8","9","not_recorded")))
#change BCS to be over underweight
cohort_abr2 <- cohort_abr2 %>%
mutate(mode_BCS_classify = case_when(
mode_purina_BCS_5y_prior_endpoint == "1" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "2" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "3" ~"underweight",
mode_purina_BCS_5y_prior_endpoint == "4" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "5" ~"ideal",
mode_purina_BCS_5y_prior_endpoint == "6" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "7" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "8" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "9" ~"overweight",
mode_purina_BCS_5y_prior_endpoint == "not_recorded" ~"not_recorded",
))
#set age levels
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_bio = factor(age_at_final_date_bio, levels = c(">5-<8y","<5y",  ">8-<11y", ">11-<13y",">13y")))
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_GB = factor(age_at_final_date_GB, levels = c(">7-<9y","<5y", ">5-<7y",  ">9-<11y",">11-<13y",">13y")))
#manually assign height, weight, BCS factor levles and age at neuter and age at diagnosis
#height
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_quartiles = factor(avg_weight_5y_prior_endpoint_quartiles, levels = c("12.47-<20.83kg", ">=20.83-<23.23kg", ">=23.23-26.98kg", ">=26.98-37.01","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_weight_5y_prior_endpoint_kg_biological = factor(avg_weight_5y_prior_endpoint_kg_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_quartiles, levels = c("10.5-<17.1kg", ">=17.1-<24.7kg", ">=24.7-30.6kg", ">=30.6-49.1kg","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_any_records_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#weight median all 5 record years
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_quartiles, levels = c("10.5-<16.1kg", ">=16.1-<21.3kg", ">=21.3-28.8kg", ">=28.8-47.1kg","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(median_weight_5y_prior_endpoint_kg_outliers_removed_biological = factor(median_weight_5y_prior_endpoint_kg_outliers_removed_biological, levels = c(">15-<=25kg",">25-<=35kg",">35","not_recorded")))
#bcs
cohort_abr2 <- cohort_abr2%>%
mutate(avg_purina_BCS_5y_prior_endpoint_quartiles = factor(avg_purina_BCS_5y_prior_endpoint_quartiles, levels = c("3.3-<5", ">=5-<5.28", ">=5.28-<5.86", ">=5.86 - 9","not_recorded")))
#neut age
cohort_abr2<- cohort_abr2 %>%
mutate(age_at_neuter_years_quartiles = factor(age_at_neuter_years_quartiles, levels = c("0.15-<0.52y", ">=0.52-<0.83y", ">=0.83-2.44y", ">=2.44-9.59y","Entire","not_recorded")))
#diagnosis age
cohort_abr2 <- cohort_abr2%>%
mutate(age_at_final_date_quartiles = factor(age_at_final_date_quartiles, levels = c("0.74-<8.47 years", ">=8.47-<10.68 years", ">=10.68-<11.64 years", ">=11.64-14.51 years","not_recorded")))
#breed tercile levels
cohort_abr2 <- cohort_abr2%>%
mutate(num_breeding_before_neutering_terciles = factor(num_breeding_before_neutering_terciles, levels = c(">0-<3",">=3-<9",">=9-142","not_bred","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(NSAID_5y_quantiles = factor(NSAID_5y_quantiles, levels = c("no_NSAID_admin", "Q1(1)", "Q2(1-2)", "Q3(2-3)","Q4(3-11)","no_med_use_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(endo_5y_quantiles = factor(endo_5y_quantiles, levels = c("no_endo_admin", "Q1(1-2)", "Q2(2-3)", "Q3(3-4)","Q4(4-17)","no_med_use_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(ecto_5y_quantiles = factor(ecto_5y_quantiles, levels = c("no_ecto_admin", "Q1(1)", "Q2(1-2)", "Q3(2-4)","Q4(4-17)","no_med_use_recorded")))
cols_to_modify <- 151:200 # replace with your actual column indices
for (i in cols_to_modify) {
current_levels <- levels(cohort_abr2[[i]])
if ("no_medication_records_for_this_time_period" %in% current_levels) {
new_levels <- c(setdiff(current_levels, "no_medication_records_for_this_time_period"), "no_medication_records_for_this_time_period")
cohort_abr2[[i]] <- factor(cohort_abr2[[i]], levels = new_levels)
}
}
#need to set the activity splits into ordinal format
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy3_splits = factor(avg_activity_freq_sy3_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_freq_sy1_2_splits = factor(avg_activity_freq_sy1_2_splits, levels = c("never","less_than_weekly","min_weekly","daily","multi_daily","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_duration_sy1_2_splits = factor(avg_activity_duration_sy1_2_splits, levels = c("less_than_30min","between_30_60_min","between_60_90_min","between_90_120_min","more_than_120_min","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_activity_intensity_sy3_splits = factor(avg_activity_intensity_sy3_splits, levels = c("slow_walks","average_walks","brisk_walks","jogs","runs","not_recorded")))
cohort_abr2 <- cohort_abr2%>%
mutate(avg_frequency_5y_prior_endpoint_splits = factor(avg_frequency_5y_prior_endpoint_splits, levels = c("rarely","monthly","weekly","daily","multi_daily","not_recorded")))
# Now run the function
univar_results <- univar_logistic_regression(cohort_abr2, "had_HSA", explanatory)
