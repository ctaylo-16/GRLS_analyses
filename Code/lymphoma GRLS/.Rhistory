dplyr::select(c(subject_id,MDI_quintile,owner_MDI_quintile))
#now join onto dog pop
dog_pop_deprivation <- dog_pop %>% left_join(deprivation, by="subject_id")
#exposures dataset
environment_exposures<-read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_conditions.csv",na.strings=c ("","NA"))
environment_exposures <- environment_exposures %>% mutate(across(where(is.character), tolower))
sleep_environment <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_sleep_location.csv",na.strings=c("","NA"))
sleep_environment <- sleep_environment %>% mutate(across(where(is.character), tolower))
#indoor variables to keep
indoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
aerosol <- environment_exposures %>%
group_by(subject_id) %>%
mutate(aerosol_ever = if_else(any(use_aerosol == 1), 1, 0))
#exposures ever for all of the indoors variables
environment_exposures_2 <- environment_exposures %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(use_aerosol:smoke_exposure,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
#outdoors variables to keep
outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
#exposures ever for all of the outdoors variables
environment_exposures_out <- outdoors %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(any_treated_weeds:any_treated_fertilizer,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
# combine indoors and outdoors (cant combine sleeping as is different length)
indoors_outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure,hours_of_smoke,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
#set indoors outdoors date column as date then parse year from it
indoors_outdoors$date_2 <-parse_date_time(indoors_outdoors$record_date,"ym")
#parse year from
indoors_outdoors <- indoors_outdoors %>% mutate(exposure_year = as.numeric(format(date_2, "%Y")))
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
#delete rows with NA of record date in it in the indoors_outdoors
indoors_outdoors2 <- indoors_outdoors %>%
filter(!is.na(record_date))
#join records - do it this way so that each of the years of study for enviro exposures are retained
exposure <- left_join(indoors_outdoors2,dog_pop_deprivation,by="subject_id")
#then fill in all rows for that patient with its diagnosis date (or else lose all the rwos except 1 for each dog)
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month_date2,.direction="downup")
dog_pop_deprivation_2 <- years_prior_to(dog_pop_deprivation,diagnosis_year,5)
# Specify the columns to check
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
#code to check for all relevant columns
exposure_years <-5
dog_pop_deprivation_enviro5y<- check_exposure(exposure, columns_to_check, diagnosis_year, exposure_years)
#strip down to single row for each dog
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early<- check_exposure2(environment_exposures_2, columns_to_check, study_years,year_column)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
enviro_rest <- environment_exposures_2 %>%
filter(year_in_study ==3 |year_in_study ==4 |year_in_study ==5|year_in_study ==6|year_in_study ==7|year_in_study ==8|year_in_study ==9|year_in_study ==10)
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_rest <- check_exposure2(enviro_rest, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2,3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_rest<- check_exposure2(environment_exposures_2, columns_to_check, study_years,year_column)
library(tidyverse)
library(lubridate)
dog_pop <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/lymphoma_cohort_241201.csv")
#remove excess cols
dog_pop <- dog_pop %>%
dplyr::select(-c(record_date))
dog_pop$diagnosis_year_month_date <- as.Date(dog_pop$end_date)
# create a year column in  file so can do calculations on year (no point being more precise as questionaire done annually and may not match diagnosis time)
dog_pop$diagnosis_year <- as.numeric(format(dog_pop$diagnosis_year_month_date,"%Y"))
# set to month level (not day of month) = all on 1st day of month
dog_pop$diagnosis_year_month_date2 <- as.POSIXct(floor_date(dog_pop$diagnosis_year_month_date,unit="month"))
# get year month bit from column
# set to month level (not day of month) = all on 1st day of month
dog_pop$diagnosis_year_month <- format(dog_pop$diagnosis_year_month_date, "%Y-%m")
deprivation <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_dogs_MDI_2019.csv")
deprivation <- deprivation %>%
dplyr::select(c(subject_id,MDI_quintile,owner_MDI_quintile))
#now join onto dog pop
dog_pop_deprivation <- dog_pop %>% left_join(deprivation, by="subject_id")
#exposures dataset
environment_exposures<-read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_conditions.csv",na.strings=c ("","NA"))
environment_exposures <- environment_exposures %>% mutate(across(where(is.character), tolower))
sleep_environment <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_sleep_location.csv",na.strings=c("","NA"))
sleep_environment <- sleep_environment %>% mutate(across(where(is.character), tolower))
#indoor variables to keep
indoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
aerosol <- environment_exposures %>%
group_by(subject_id) %>%
mutate(aerosol_ever = if_else(any(use_aerosol == 1), 1, 0))
#exposures ever for all of the indoors variables
environment_exposures_2 <- environment_exposures %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(use_aerosol:smoke_exposure,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
#outdoors variables to keep
outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
#exposures ever for all of the outdoors variables
environment_exposures_out <- outdoors %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(any_treated_weeds:any_treated_fertilizer,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
# combine indoors and outdoors (cant combine sleeping as is different length)
indoors_outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure,hours_of_smoke,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
#set indoors outdoors date column as date then parse year from it
indoors_outdoors$date_2 <-parse_date_time(indoors_outdoors$record_date,"ym")
#parse year from
indoors_outdoors <- indoors_outdoors %>% mutate(exposure_year = as.numeric(format(date_2, "%Y")))
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
#delete rows with NA of record date in it in the indoors_outdoors
indoors_outdoors2 <- indoors_outdoors %>%
filter(!is.na(record_date))
#join records - do it this way so that each of the years of study for enviro exposures are retained
exposure <- left_join(indoors_outdoors2,dog_pop_deprivation,by="subject_id")
#then fill in all rows for that patient with its diagnosis date (or else lose all the rwos except 1 for each dog)
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month_date2,.direction="downup")
dog_pop_deprivation_2 <- years_prior_to(dog_pop_deprivation,diagnosis_year,5)
# Specify the columns to check
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
#code to check for all relevant columns
exposure_years <-5
dog_pop_deprivation_enviro5y<- check_exposure(exposure, columns_to_check, diagnosis_year, exposure_years)
#strip down to single row for each dog
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early<- check_exposure2(environment_exposures_2, columns_to_check, study_years,year_column)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
enviro_rest <- environment_exposures_2 %>%
filter(year_in_study ==3 |year_in_study ==4 |year_in_study ==5|year_in_study ==6|year_in_study ==7|year_in_study ==8|year_in_study ==9|year_in_study ==10)
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_rest <- check_exposure2(enviro_rest, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2,3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_whole<- check_exposure2(environment_exposures_2, columns_to_check, study_years,year_column)
View(environment_exposures_2)
library(tidyverse)
library(lubridate)
dog_pop <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/lymphoma_cohort_241201.csv")
#remove excess cols
dog_pop <- dog_pop %>%
dplyr::select(-c(record_date))
dog_pop$diagnosis_year_month_date <- as.Date(dog_pop$end_date)
# create a year column in  file so can do calculations on year (no point being more precise as questionaire done annually and may not match diagnosis time)
dog_pop$diagnosis_year <- as.numeric(format(dog_pop$diagnosis_year_month_date,"%Y"))
# set to month level (not day of month) = all on 1st day of month
dog_pop$diagnosis_year_month_date2 <- as.POSIXct(floor_date(dog_pop$diagnosis_year_month_date,unit="month"))
# get year month bit from column
# set to month level (not day of month) = all on 1st day of month
dog_pop$diagnosis_year_month <- format(dog_pop$diagnosis_year_month_date, "%Y-%m")
deprivation <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Output/GRLS_dogs_MDI_2019.csv")
deprivation <- deprivation %>%
dplyr::select(c(subject_id,MDI_quintile,owner_MDI_quintile))
#now join onto dog pop
dog_pop_deprivation <- dog_pop %>% left_join(deprivation, by="subject_id")
#exposures dataset
environment_exposures<-read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_conditions.csv",na.strings=c ("","NA"))
environment_exposures <- environment_exposures %>% mutate(across(where(is.character), tolower))
sleep_environment <- read.csv("C:/Users/ctaylor18/GitHub/GRLS_analyses/Data/environment_sleep_location.csv",na.strings=c("","NA"))
sleep_environment <- sleep_environment %>% mutate(across(where(is.character), tolower))
#indoor variables to keep
indoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
aerosol <- environment_exposures %>%
group_by(subject_id) %>%
mutate(aerosol_ever = if_else(any(use_aerosol == 1), 1, 0))
#exposures ever for all of the indoors variables
environment_exposures_2 <- environment_exposures %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(use_aerosol:smoke_exposure,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
#outdoors variables to keep
outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
##create a 2nd variable for each of the 6 variables for exposure to that ever eg. aerosol ever Y N
#exposures ever for all of the outdoors variables
environment_exposures_out <- outdoors %>%
group_by(subject_id) %>%
#go across each column and if the subject has a 1 in any of its rows for each column then put it as a 1 in the new column else it is a 0
mutate(across(any_treated_weeds:any_treated_fertilizer,~if_else(any(.==1),1,0),.names="ever_{.col}")) %>% ungroup()
# combine indoors and outdoors (cant combine sleeping as is different length)
indoors_outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure,hours_of_smoke,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
#set indoors outdoors date column as date then parse year from it
indoors_outdoors$date_2 <-parse_date_time(indoors_outdoors$record_date,"ym")
#parse year from
indoors_outdoors <- indoors_outdoors %>% mutate(exposure_year = as.numeric(format(date_2, "%Y")))
View(environment_exposures_2)
View(indoors_outdoors)
indoors_outdoors_1_row_year <- indoors_outdoors %>%
filter(!is.na(record_date))
View(indoors_outdoors_1_row_year)
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early<- check_exposure2(indoors_outdoors_1_row_year, columns_to_check, study_years,year_column)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
enviro_rest <- dog_pop_deprivation_enviro_early %>%
filter(year_in_study ==3 |year_in_study ==4 |year_in_study ==5|year_in_study ==6|year_in_study ==7|year_in_study ==8|year_in_study ==9|year_in_study ==10)
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early_rest <- check_exposure2(enviro_rest, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
dog_pop_deprivation_enviro_early_rest2 <- check_exposure2(dog_pop_deprivation_enviro_early, columns_to_check, study_years,year_column)
View(dog_pop_deprivation_enviro_early_rest2)
table(dog_pop_deprivation_enviro_early_rest2$use_incense_or_candles_study_years_0_1_2)
table(dog_pop_deprivation_enviro_early_rest2$use_incense_or_candles_study_years_3_4_5_6_7_8_9_10)
table(dog_pop_deprivation_enviro_early_rest$use_incense_or_candles_study_years_0_1_2)
table(dog_pop_deprivation_enviro_early_rest2$use_incense_or_candles_study_years_3_4_5_6_7_8_9_10)
table(dog_pop_deprivation_enviro_early_rest$use_incense_or_candles_study_years_3_4_5_6_7_8_9_10)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early_rest2 <- check_exposure2(dog_pop_deprivation_enviro_early, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early_rest <- check_exposure2(dog_pop_deprivation_enviro_early, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2,3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_whole<- check_exposure2(dog_pop_deprivation_enviro_early_rest, columns_to_check, study_years,year_column)
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
#delete rows with NA of record date in it in the indoors_outdoors
indoors_outdoors2 <- indoors_outdoors %>%
filter(!is.na(record_date))
#join records - do it this way so that each of the years of study for enviro exposures are retained
exposure <- left_join(indoors_outdoors2,dog_pop_deprivation,by="subject_id")
#then fill in all rows for that patient with its diagnosis date (or else lose all the rwos except 1 for each dog)
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month_date2,.direction="downup")
dog_pop_deprivation_2 <- years_prior_to(dog_pop_deprivation,diagnosis_year,5)
# Specify the columns to check
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
#code to check for all relevant columns
exposure_years <-5
dog_pop_deprivation_enviro5y<- check_exposure(exposure, columns_to_check, diagnosis_year, exposure_years)
#strip down to single row for each dog
View(dog_pop_deprivation_enviro5y)
dog_pop_deprivation_enviro__early_rest_whole<- check_exposure2(dog_pop_deprivation_enviro_early_rest, columns_to_check, study_years,year_column)
dog_pop_deprivation_enviro__early_rest_whole
print(colnames(dog_pop_deprivation_enviro__early_rest_whole))
dog_pop_deprivation_enviro__early_rest_whole2 <- dog_pop_deprivation_enviro__early_rest_whole %>%
rename_with(
~ gsub("_0_1_2$", "_early_life", .),
ends_with("_0_1_2")
)
dog_pop_deprivation_enviro__early_rest_whole3 <- dog_pop_deprivation_enviro__early_rest_whole2 %>%
rename_with(
~ gsub("_0_1_2_3_4_5_6_7_8_9_10$", "_whole_life", .),
ends_with("_0_1_2_3_4_5_6_7_8_9_10")
)
dog_pop_deprivation_enviro__early_rest_whole4 <- dog_pop_deprivation_enviro__early_rest_whole3 %>%
rename_with(
~ gsub("_3_4_5_6_7_8_9_10$","_rest_of_life",.),
ends_with("_3_4_5_6_7_8_9_10")
)
#check renaming all OK
print(colnames(dog_pop_deprivation_enviro__early_rest_whole4))
dog_pop_deprivation_enviro__early_rest_whole4_distinct <- dog_pop_deprivation_enviro__early_rest_whole4 %>% distinct(subject_id)
View(dog_pop_deprivation_enviro__early_rest_whole4_distinct)
dog_pop_deprivation_enviro__early_rest_whole4_distinct <- dog_pop_deprivation_enviro__early_rest_whole4 %>% distinct(subject_id,keep.all=TRUE)
View(dog_pop_deprivation_enviro__early_rest_whole4_distinct)
dog_pop_deprivation_enviro__early_rest_whole4_distinct <- dog_pop_deprivation_enviro__early_rest_whole4 %>% distinct(subject_id,keep_all=TRUE)
View(dog_pop_deprivation_enviro__early_rest_whole4_distinct)
dog_pop_deprivation_enviro__early_rest_whole4_distinct <- dog_pop_deprivation_enviro__early_rest_whole4 %>% distinct(subject_id,.keep_all=TRUE)
smoking_df <- dog_pop_deprivation_enviro__early_rest_whole4%>%
filter(!grepl("see detail rows", hours_of_smoke))
smoking_df <- smoking_df %>%
mutate(hours_of_smoke= as.numeric(hours_of_smoke))
smoking_df$hours_of_smoke
smoking_df <- dog_pop_deprivation_enviro__early_rest_whole4%>%
filter(!grepl("see detail rows", hours_of_smoke))
View(smoking_df)
smoking_df <- smoking_df %>%
mutate(hours_of_smoke2= as.numeric(hours_of_smoke))
#convert column to numeric now
smoking_df <- smoking_df %>%
mutate(hours_of_smoke= as.numeric(hours_of_smoke))
#create a record_year variable
#had to use lubridate not as.POSIX for getting character string into date
smoking_df <- smoking_df %>%
mutate(record_date2=ym(record_date)) %>%
mutate(record_year = as.numeric(format(record_date2, "%Y")))
# function to calculate hours of smoke exposed to prior to diagnosis
#dosage function applied
smoking_df2 <- exposure_dosage(smoking_df,"hours_of_smoke","record_year","diagnosis_year")
View(smoking_df)
# combine indoors and outdoors (cant combine sleeping as is different length)
indoors_outdoors <- environment_exposures %>% select(c(subject_id,year_in_study,record_date,use_aerosol,use_air_cleaner,use_hepa_filter,use_moth_balls,use_incense_or_candles,smoke_exposure,hours_of_smoke,any_treated_weeds,any_treated_insects,any_treated_fertilizer))
#set indoors outdoors date column as date then parse year from it
indoors_outdoors$date_2 <-parse_date_time(indoors_outdoors$record_date,"ym")
#parse year from
indoors_outdoors <- indoors_outdoors %>% mutate(exposure_year = as.numeric(format(date_2, "%Y")))
#remove rows where it is the NA record date column
indoors_outdoors_1_row_year <- indoors_outdoors %>%
filter(!is.na(record_date))
#join this to deprivation data made above
indoors_outdoors_1_row_year <- indoors_outdoors_1_row_year %>%
left_join(dog_pop_deprivation,by="subject_id")
View(indoors_outdoors_1_row_year)
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early<- check_exposure2(indoors_outdoors_1_row_year, columns_to_check, study_years,year_column)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro_early_rest <- check_exposure2(dog_pop_deprivation_enviro_early, columns_to_check, study_years,year_column)
#count how many years exposed for (sum up the 1s)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
# apply check exposure function
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
study_years <- c(0,1,2,3,4,5,6,7,8,9,10)
year_column <-"year_in_study"
dog_pop_deprivation_enviro__early_rest_whole<- check_exposure2(dog_pop_deprivation_enviro_early_rest, columns_to_check, study_years,year_column)
#read in function file for all GRLS functions:
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
#delete rows with NA of record date in it in the indoors_outdoors
indoors_outdoors2 <- indoors_outdoors %>%
filter(!is.na(record_date))
#join records - do it this way so that each of the years of study for enviro exposures are retained
exposure <- left_join(indoors_outdoors2,dog_pop_deprivation,by="subject_id")
#then fill in all rows for that patient with its diagnosis date (or else lose all the rwos except 1 for each dog)
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year,.direction="downup")
exposure <- exposure %>%
group_by(subject_id)%>%
fill(diagnosis_year_month_date2,.direction="downup")
dog_pop_deprivation_2 <- years_prior_to(dog_pop_deprivation,diagnosis_year,5)
# Specify the columns to check
columns_to_check <- c("use_aerosol", "use_air_cleaner", "use_hepa_filter",
"use_moth_balls", "use_incense_or_candles", "smoke_exposure",
"any_treated_weeds", "any_treated_insects", "any_treated_fertilizer")
#code to check for all relevant columns
exposure_years <-5
dog_pop_deprivation_enviro5y<- check_exposure(exposure, columns_to_check, diagnosis_year, exposure_years)
#strip down to single row for each dog
dog_pop_deprivation_enviro__early_rest_whole
print(colnames(dog_pop_deprivation_enviro__early_rest_whole))
dog_pop_deprivation_enviro__early_rest_whole2 <- dog_pop_deprivation_enviro__early_rest_whole %>%
rename_with(
~ gsub("_0_1_2$", "_early_life", .),
ends_with("_0_1_2")
)
dog_pop_deprivation_enviro__early_rest_whole3 <- dog_pop_deprivation_enviro__early_rest_whole2 %>%
rename_with(
~ gsub("_0_1_2_3_4_5_6_7_8_9_10$", "_whole_life", .),
ends_with("_0_1_2_3_4_5_6_7_8_9_10")
)
dog_pop_deprivation_enviro__early_rest_whole4 <- dog_pop_deprivation_enviro__early_rest_whole3 %>%
rename_with(
~ gsub("_3_4_5_6_7_8_9_10$","_rest_of_life",.),
ends_with("_3_4_5_6_7_8_9_10")
)
#check renaming all OK
print(colnames(dog_pop_deprivation_enviro__early_rest_whole4))
#remove rows that say see detail rows as these are meaningless - this may have been done in an earlier tidying step
smoking_df <- dog_pop_deprivation_enviro__early_rest_whole4%>%
filter(!grepl("see detail rows", hours_of_smoke))
#convert column to numeric now
smoking_df <- smoking_df %>%
mutate(hours_of_smoke= as.numeric(hours_of_smoke))
#create a record_year variable
#had to use lubridate not as.POSIX for getting character string into date
smoking_df <- smoking_df %>%
mutate(record_date2=ym(record_date)) %>%
mutate(record_year = as.numeric(format(record_date2, "%Y")))
# function to calculate hours of smoke exposed to prior to diagnosis
#dosage function applied
smoking_df2 <- exposure_dosage(smoking_df,"hours_of_smoke","record_year","diagnosis_year")
View(smoking_df2)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
study_years <- c(0,1,2)
smoking_df3 <- exposure_dosage2(smoking_df2,"hours_of_smoke",study_years)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
study_years <- c(3,4,5,6,7,8,9,10)
smoking_df4 <- exposure_dosage2(smoking_df3,"hours_of_smoke",study_years)
source("C:/Users/ctaylor18/GitHub/GRLS_analyses/Code/GRLS_functions.R")
study_years <- c(0,1,2,3,4,5,6,7,8,9,10)
smoking_df5 <- exposure_dosage2(smoking_df4,"hours_of_smoke",study_years)
smoking_df6 <- smoking_df5 %>%
rename("hours_of_smoke_early_life_total_dosage"= "hours_of_smoke_0_1_2_total_dosage") %>%
rename("hours_of_smoke_rest_of_life_total_dosage" = "hours_of_smoke_3_4_5_6_7_8_9_10_total_dosage") %>%
rename("hours_of_smoke_whole_life_total_dosage"= "hours_of_smoke_0_1_2_3_4_5_6_7_8_9_10_total_dosage")
print(colnames(smoking_df6))
View(smoking_df6)
#all the binary for early, rest, whole here
dog_pop_deprivation_enviro__early_rest_whole4_distinct <- dog_pop_deprivation_enviro__early_rest_whole4 %>%
distinct(subject_id,.keep_all=TRUE)
#all the binary for 5y prior to endpoint here
dog_pop_deprivation_enviro5y_distinct <- dog_pop_deprivation_enviro5y %>%
distinct(subject_id,.keep_all = TRUE)
#smoking hours df
smoking_df6_distinct <- smoking_df6 %>%
distinct(subject_id,.keep_all = TRUE)
dog_pop_deprivation_enviro_smoking_all <-  dog_pop_deprivation_enviro__early_rest_whole4_distinct %>%
left_join(dog_pop_deprivation_enviro5y_distinct , by = "subject_id") %>%
left_join(smoking_df6_distinct , by = "subject_id")
View(dog_pop_deprivation_enviro_smoking_all)
View(smoking_df6_distinct)
print(colnames(smoking_df))
colnames(dog_pop_deprivation_enviro5y_distinct)
dplyr::select(c(subject_id,use_aerosol_5y,use_air_cleaner_5y,use_hepa_filter_5y,use_moth_balls_5y,use_incense_or_candles_5y,smoke_exposure_5y,any_treated_weeds_5y,any_treated_insects_5y,any_treated_fertilizer_5y))
dplyr::select(c(subject_id,use_aerosol_5y,use_air_cleaner_5y,use_hepa_filter_5y,use_moth_balls_5y,use_incense_or_candles_5y,smoke_exposure_5y,any_treated_weeds_5y,any_treated_insects_5y,any_treated_fertilizer_5y))
distinct(subject_id,.keep_all = TRUE)
dog_pop_deprivation_enviro5y_distinct <- dog_pop_deprivation_enviro5y %>%
distinct(subject_id,.keep_all = TRUE)
#keep only the rows not in the smoking_
dplyr::select(c(subject_id,use_aerosol_5y,use_air_cleaner_5y,use_hepa_filter_5y,use_moth_balls_5y,use_incense_or_candles_5y,smoke_exposure_5y,any_treated_weeds_5y,any_treated_insects_5y,any_treated_fertilizer_5y))
dplyr::select(c(subject_id,use_aerosol_5y,use_air_cleaner_5y,use_hepa_filter_5y,use_moth_balls_5y,use_incense_or_candles_5y,smoke_exposure_5y,any_treated_weeds_5y,any_treated_insects_5y,any_treated_fertilizer_5y))
